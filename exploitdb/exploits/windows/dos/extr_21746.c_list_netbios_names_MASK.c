
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_4__ TYPE_2__ ;
typedef struct TYPE_3__ TYPE_1__ ;


typedef int uint8_t ;
typedef scalar_t__ uint16_t ;
struct timeval {unsigned int tv_sec; scalar_t__ tv_usec; } ;
struct TYPE_3__ {long s_addr; } ;
struct sockaddr_in {void* class; void* type; int query; void* questions; void* flags; scalar_t__ transaction_id; int sin_port; TYPE_1__ sin_addr; int sin_family; } ;
struct sockaddr {int dummy; } ;
struct hostent {scalar_t__ h_addr; } ;
struct TYPE_4__ {int names; } ;
typedef TYPE_2__ nbt_name_query_answer ;
typedef struct sockaddr_in nbt_name_query ;
typedef int fd_set ;


 int VAR_0 ;
 int FUNC_0 (int,int *) ;
 int FUNC_1 (int *) ;
 int VAR_1 ;
 void* FUNC_2 (int) ;
 int VAR_2 ;
 int FUNC_3 (int ,char*,...) ;
 struct hostent* FUNC_4 (char const*) ;
 int FUNC_5 (unsigned short) ;
 int FUNC_6 (struct sockaddr_in*,int ,int) ;
 int FUNC_7 (char*,int ,int ) ;
 int FUNC_8 (char*,...) ;
 int FUNC_9 (int,unsigned char*,size_t,int ,int *,int *) ;
 int FUNC_10 (int,int *,int *,int *,struct timeval*) ;
 int FUNC_11 (int,struct sockaddr_in*,int,int ,struct sockaddr*,int) ;
 int FUNC_12 (int ,int ,int ) ;
 int VAR_3 ;
 char* FUNC_13 (int ) ;

char *
FUNC_14 (unsigned char *VAR_4, size_t VAR_5, const char *VAR_6,
                    unsigned short VAR_7, unsigned int VAR_8)
{
  nbt_name_query VAR_9;
  struct sockaddr_in VAR_10;
  struct hostent *VAR_11;
  int VAR_12, VAR_13;

  fd_set VAR_14;
  struct timeval VAR_15;

  FUNC_8 ("Trying to list netbios names on %s\n", VAR_6);

  VAR_11 = FUNC_4 (VAR_6);
  if (VAR_11 == ((void*)0))
    {
      FUNC_3 (VAR_3, "Could not resolve host: %s\n", VAR_6);
      return ((void*)0);
    }

  FUNC_6 (&VAR_10, 0, sizeof (struct sockaddr_in));

  VAR_10.sin_family = VAR_0;
  VAR_10.sin_addr.s_addr = *(long *) (VAR_11->h_addr);
  VAR_10.sin_port = FUNC_5 (VAR_7);

  if ((VAR_12 = FUNC_12 (VAR_0, VAR_1, 0)) < 0)
    {
      FUNC_3 (VAR_3, "Could not setup the UDP socket: %s\n",
               FUNC_13 (VAR_2));
      return ((void*)0);
    }

  FUNC_6 (&VAR_9, 0, sizeof (nbt_name_query));

  VAR_9.transaction_id = (uint16_t) FUNC_2 (0x1e);
  VAR_9.flags = FUNC_2 (0x0010);
  VAR_9.questions = FUNC_2 (1);

  FUNC_7 ("*", VAR_9.query, 0);
  VAR_9.type = FUNC_2 (0x21);
  VAR_9.class = FUNC_2 (0x01);

  if (FUNC_11
      (VAR_12, &VAR_9, sizeof (nbt_name_query), 0, (struct sockaddr *) &VAR_10,
       sizeof (struct sockaddr_in)) != sizeof (nbt_name_query))
    {
      FUNC_3 (VAR_3, "Could not send UDP packet: %s\n", FUNC_13 (VAR_2));
      return ((void*)0);
    }



  FUNC_1 (&VAR_14);
  FUNC_0 (VAR_12, &VAR_14);

  VAR_15.tv_sec = VAR_8;
  VAR_15.tv_usec = 0;

  if (!FUNC_10 (VAR_12 + 1, &VAR_14, ((void*)0), ((void*)0), &VAR_15))
    {
      FUNC_3 (VAR_3,
               "The udp read has reached the timeout - try setting the netbios name manually - exiting...\n");
      return ((void*)0);
    }

  FUNC_9 (VAR_12, VAR_4, VAR_5, 0, ((void*)0), ((void*)0));

  for (VAR_13 = 0; VAR_13 < ((nbt_name_query_answer *) VAR_4)->names; VAR_13++)
    if ((uint8_t) * (VAR_4 + sizeof (nbt_name_query_answer) + 18 * VAR_13 + 15) ==
        0x20)
      return VAR_4 + sizeof (nbt_name_query_answer) + 18 * VAR_13;

  FUNC_8 ("No netbios name available for use - you probably won't be able to crash this host\n");
  FUNC_8 ("However, you can try setting one manually\n");

  return ((void*)0);
}
