
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_8__ TYPE_4__ ;
typedef struct TYPE_7__ TYPE_3__ ;
typedef struct TYPE_6__ TYPE_2__ ;
typedef struct TYPE_5__ TYPE_1__ ;


typedef scalar_t__ ULONG ;
struct TYPE_8__ {scalar_t__ VirtualAddress; int SizeOfBlock; } ;
struct TYPE_7__ {scalar_t__ Type; scalar_t__ Offset; } ;
struct TYPE_5__ {scalar_t__ ImageBase; } ;
struct TYPE_6__ {TYPE_1__ OptionalHeader; } ;
typedef scalar_t__ PVOID ;
typedef int* PUSHORT ;
typedef scalar_t__* PULONG ;
typedef TYPE_2__* PIMAGE_NT_HEADERS ;
typedef TYPE_3__* PIMAGE_FIXUP_ENTRY ;
typedef TYPE_4__* PIMAGE_BASE_RELOCATION ;
typedef int IMAGE_BASE_RELOCATION ;


 int VAR_0 ;
 int VAR_1 ;
 scalar_t__ VAR_2 ;
 scalar_t__ FUNC_0 (scalar_t__,int ,int ,scalar_t__*) ;
 scalar_t__ FUNC_1 (scalar_t__) ;

ULONG FUNC_2(PVOID VAR_3, ULONG VAR_4)
{
        PIMAGE_NT_HEADERS VAR_5;
        PIMAGE_BASE_RELOCATION VAR_6;
        PIMAGE_FIXUP_ENTRY VAR_7;
        ULONG VAR_8 = 0;
        ULONG VAR_9, VAR_10, VAR_11, VAR_12;

        VAR_9 = VAR_4 - (ULONG)VAR_3;
        VAR_5 = (PIMAGE_NT_HEADERS)FUNC_1(VAR_3);
        VAR_6 = (PIMAGE_BASE_RELOCATION)FUNC_0(VAR_3, VAR_0, VAR_1, &VAR_8);
        if(VAR_6 == ((void*)0))
                return 0;

        do
        {
                VAR_7 = (PIMAGE_FIXUP_ENTRY)((ULONG)VAR_6 + sizeof(IMAGE_BASE_RELOCATION));

                VAR_8 = (VAR_6->SizeOfBlock - sizeof(IMAGE_BASE_RELOCATION)) >> 1;
                for(VAR_10 = 0; VAR_10 < VAR_8; VAR_10++, VAR_7++)
                {
                        if(VAR_7->Type == VAR_2)
                        {
                                VAR_11 = VAR_6->VirtualAddress + VAR_7->Offset;
                                VAR_12 = *(PULONG)((ULONG)VAR_3 + VAR_11) - (ULONG)VAR_5->OptionalHeader.ImageBase;

                                if(VAR_12 == VAR_9)
                                {
                                   if (*(PUSHORT)((ULONG)VAR_3 + VAR_11 - 2) == 0x05c7)
                                                return *(PULONG)((ULONG)VAR_3 + VAR_11 + 4) - VAR_5->OptionalHeader.ImageBase;
                                }
                        }
                }

                *(PULONG)&VAR_6 += VAR_6->SizeOfBlock;

        } while(VAR_6->VirtualAddress);

        return 0;
}
