
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_4__ TYPE_2__ ;
typedef struct TYPE_3__ TYPE_1__ ;


struct TYPE_4__ {int tv_sec; scalar_t__ tv_usec; } ;
struct TYPE_3__ {int tv_sec; scalar_t__ tv_usec; } ;
struct itimerval {TYPE_2__ it_value; TYPE_1__ it_interval; } ;
typedef int Connect ;


 char* VAR_0 ;
 int VAR_1 ;
 int VAR_2 ;
 char* VAR_3 ;




 int VAR_4 ;
 scalar_t__ VAR_5 ;
 int FUNC_0 (int) ;
 int FUNC_1 (int,unsigned int) ;
 int FUNC_2 (int) ;
 int * FUNC_3 (char*,char*) ;
 int FUNC_4 (int *,char*,...) ;
 int * VAR_6 ;
 int FUNC_5 (int,unsigned int,char*) ;
 int FUNC_6 (char*) ;
 int FUNC_7 (int,char*,int) ;
 int FUNC_8 (int,unsigned char*,unsigned int*,char*) ;
 int FUNC_9 (int) ;
 int FUNC_10 (int,char*,char*) ;
 int FUNC_11 (int ,struct itimerval*,int) ;
 scalar_t__ FUNC_12 (int ,int ) ;
 int * VAR_7 ;
 unsigned int FUNC_13 (char*) ;
 scalar_t__ FUNC_14 (char*,char*,unsigned int) ;
 int VAR_8 ;
 int FUNC_15 (int,char*,unsigned int) ;

int
FUNC_16(int VAR_9, char * VAR_10[]){
unsigned int VAR_11;
  int VAR_12 = 0;
  char *VAR_13;
  char VAR_14[4096];
  char VAR_15;
  char VAR_16[1024];
  int VAR_17;

  int VAR_18 = 1;
  struct itimerval VAR_19;



  if((VAR_6 = FUNC_3("/dev/tty", "w")) == ((void*)0)){
    FUNC_6("Can't open /dev/tty");

    VAR_6 = VAR_7;
  }

  if(FUNC_12(VAR_4, VAR_8) == VAR_5){
    FUNC_4(VAR_6, "Couldn't set the signal handler");
    FUNC_2(1);
  }

  VAR_19.it_interval.tv_sec = 5;
  VAR_19.it_interval.tv_usec = 0;
  VAR_19.it_value.tv_sec = 5;
  VAR_19.it_value.tv_usec = 0;


  if(FUNC_11(VAR_1, &VAR_19, 0x00) == -1){
    FUNC_4(VAR_6, "Couldn't set the signal handler");
    FUNC_2(1);
  }




  VAR_17 = FUNC_7(VAR_12, VAR_16, sizeof(Connect));
  if(VAR_17 != sizeof(Connect)){
    FUNC_4(VAR_6, "Can't read \"Connect\" from the net\n");
    FUNC_2(1);
  }




  VAR_17 = FUNC_7(VAR_12, VAR_16, FUNC_13(VAR_0));
  if(VAR_17 != FUNC_13(VAR_0)){
    FUNC_4(VAR_6, "Connection closed before double \\n\n");
    FUNC_2(1);
  }

  while(FUNC_14(VAR_16, VAR_0, FUNC_13(VAR_0)) != 0){
    FUNC_4(VAR_6, "%s\n", VAR_16);


    int VAR_20;
    for(VAR_20 = 0; VAR_20 < FUNC_13(VAR_0) - 1; VAR_20++){
      VAR_16[VAR_20] = VAR_16[VAR_20+1];
    }
    VAR_17 = FUNC_7(VAR_12, &VAR_16[FUNC_13(VAR_0) - 1], 1);
    if(VAR_17 != 1){
      FUNC_4(VAR_6, "Connection closed before double \\n\n");
      FUNC_2(1);
    }
  }



  FUNC_15(VAR_18, VAR_3, FUNC_13(VAR_3));
  FUNC_4(VAR_6, "Connected (hopefully)\n");


  FUNC_1(VAR_12, FUNC_13("GNUTELLA/0.6 200 OK\r\n\r\n"));

  unsigned char VAR_21;
  unsigned VAR_22;
  char VAR_23[VAR_2];
  char VAR_24[16];

  int VAR_25 = 0;

  while(1){
    if(!FUNC_8(VAR_12,
      &VAR_21,
      &VAR_22,
      VAR_24)) break;
    FUNC_0(VAR_22 <= VAR_2);
    switch(VAR_21){
    case 131:

      FUNC_4(VAR_6, "Received a Ping message\n");
      if(VAR_22 != 0){
 FUNC_4(VAR_6, "Payload for Ping > 0 !\n");
      }
      FUNC_4(VAR_6, "Sending a Pong message\n");
      FUNC_9(VAR_18);
      break;
    case 130:

      FUNC_4(VAR_6, "Received a Pong message\n");
      if(!FUNC_1(VAR_12, VAR_22)) break;
      break;
    case 128:

      FUNC_4(VAR_6, "Received a Query message\n");
      if(!FUNC_5(VAR_12, VAR_22, VAR_14)) break;
      if(!VAR_25){
 VAR_25 = 1;
 FUNC_4(VAR_6, "Sending a QueryHit message\n");
 FUNC_10(VAR_18, VAR_14, VAR_24);
 FUNC_4(VAR_6, "QueryHit sent\n");
      } else {
 FUNC_4(VAR_6, "NOT sending a QueryHit message\n");
      }
      break;
    case 129:

      FUNC_4(VAR_6, "Received a Push message\n");
      if(!FUNC_1(VAR_12, VAR_22)) break;
      break;
    }
  }
}
